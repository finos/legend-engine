// Copyright 2022 Goldman Sachs
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

import meta::protocols::generation::java::translation::*;

Class meta::protocols::generation::java::tests::model::exclude::ToExclude
{

}

Class meta::protocols::generation::java::tests::model::exclude::a::ToExclude
{

}

Class meta::protocols::generation::java::tests::model::exclude::b::a::ToExclude
{

}

Class meta::protocols::generation::java::tests::model::store::Store extends meta::pure::store::Store
{
  // sample store to test proper protocol inheritance
}

Class meta::protocols::generation::java::tests::provided::model::pojo::ProvidedPojo
{
  // sample adhoc pojo to test proper protocol inheritance
}

Class meta::protocols::generation::java::tests::model::pojo::PojoWithInheritance extends meta::protocols::generation::java::tests::provided::model::pojo::ProvidedPojo
{
  reqFactor: Number[1];
  optionalFactor: Number[0..1];
}

Class meta::protocols::generation::java::tests::model::Message extends meta::protocols::generation::java::tests::model::ProtoBufType
{
   name:String[1];
   fields:meta::protocols::generation::java::tests::model::Field[*];
   reservedFieldNames:String[*];
   reservedFieldNumbers:Integer[*];
}

Enum meta::protocols::generation::java::tests::model::FieldFlag
{
  ON, OFF
}

Class meta::protocols::generation::java::tests::model::Field
{
   flag:meta::protocols::generation::java::tests::model::FieldFlag[1];
   binaryFieldNumber:Integer[1];
   name:String[1];
   type:meta::protocols::generation::java::tests::model::ProtoBufType[1];
   repeated:Boolean[1];
}


Class <<typemodifiers.abstract>> meta::protocols::generation::java::tests::model::ProtoBufType
{
}

Class meta::protocols::generation::java::tests::model::MessagePtr extends meta::protocols::generation::java::tests::model::ProtoBufType
{
   name : String[1];
}

Class meta::protocols::generation::java::tests::model::EnumPtr extends meta::protocols::generation::java::tests::model::ProtoBufType
{
   name : String[1];
}

Class meta::protocols::generation::java::tests::model::Enumeration extends meta::protocols::generation::java::tests::model::ProtoBufType
{
   name : String[1];
   values:meta::protocols::generation::java::tests::model::Enum[*];
}

Class meta::protocols::generation::java::tests::model::Enum
{
   constant : String[1];
   constantNumber : Integer[1];
}

Class <<typemodifiers.abstract>> meta::protocols::generation::java::tests::model::ScalarType extends meta::protocols::generation::java::tests::model::ProtoBufType
{
}

Class meta::protocols::generation::java::tests::model::scalar::Int32 extends meta::protocols::generation::java::tests::model::ScalarType
{
}

Class meta::protocols::generation::java::tests::model::scalar::Bool extends meta::protocols::generation::java::tests::model::ScalarType
{
}

Class meta::protocols::generation::java::tests::model::scalar::String extends meta::protocols::generation::java::tests::model::ScalarType
{
}

function <<test.Test>> meta::protocols::generation::java::tests::testProtocolToMetamodelTranslatorJavaGeneration():Boolean[1]
{
  let config = ^meta::protocols::generation::java::translation::Configuration(
    purePackage = 'meta::protocols::generation::java::tests::model',
    javaPackage  = 'org.finos',
    elementsToBeExcluded = 'meta::protocols::generation::java::tests::model::exclude'
  )->meta::json::toJSON();

  let sources = meta::protocols::generation::java::translation::generateProtocolToMetamodelTranslation($config, [])->map(p | $p->meta::external::language::java::metamodel::project::allClasses()->map(cl | meta::external::language::java::serialization::newStringifier($p)->meta::external::language::java::serialization::ofClass($cl->meta::external::language::java::factory::inferImports())))->sort();
  assertEquals(1, $sources->size());
  assertEquals( 'package org.finos;\n' +
                '\n' +
                'import java.util.Collections;\n' +
                'import java.util.List;\n' +
                'import org.eclipse.collections.impl.factory.Lists;\n' +
                'import org.eclipse.collections.impl.utility.ListIterate;\n' +
                'import org.finos.legend.engine.language.pure.compiler.toPureGraph.PureModel;\n' +
                'import org.finos.legend.pure.generated.Root_meta_protocols_generation_java_tests_model_Enum;\n' +
                'import org.finos.legend.pure.generated.Root_meta_protocols_generation_java_tests_model_EnumPtr;\n' +
                'import org.finos.legend.pure.generated.Root_meta_protocols_generation_java_tests_model_EnumPtr_Impl;\n' +
                'import org.finos.legend.pure.generated.Root_meta_protocols_generation_java_tests_model_Enum_Impl;\n' +
                'import org.finos.legend.pure.generated.Root_meta_protocols_generation_java_tests_model_Enumeration;\n' +
                'import org.finos.legend.pure.generated.Root_meta_protocols_generation_java_tests_model_Enumeration_Impl;\n' +
                'import org.finos.legend.pure.generated.Root_meta_protocols_generation_java_tests_model_Field;\n' +
                'import org.finos.legend.pure.generated.Root_meta_protocols_generation_java_tests_model_Field_Impl;\n' +
                'import org.finos.legend.pure.generated.Root_meta_protocols_generation_java_tests_model_Message;\n' +
                'import org.finos.legend.pure.generated.Root_meta_protocols_generation_java_tests_model_MessagePtr;\n' +
                'import org.finos.legend.pure.generated.Root_meta_protocols_generation_java_tests_model_MessagePtr_Impl;\n' +
                'import org.finos.legend.pure.generated.Root_meta_protocols_generation_java_tests_model_Message_Impl;\n' +
                'import org.finos.legend.pure.generated.Root_meta_protocols_generation_java_tests_model_ProtoBufType;\n' +
                'import org.finos.legend.pure.generated.Root_meta_protocols_generation_java_tests_model_ScalarType;\n' +
                'import org.finos.legend.pure.generated.Root_meta_protocols_generation_java_tests_model_ScalarType_Impl;\n' +
                'import org.finos.legend.pure.generated.Root_meta_protocols_generation_java_tests_model_pojo_PojoWithInheritance;\n' +
                'import org.finos.legend.pure.generated.Root_meta_protocols_generation_java_tests_model_pojo_PojoWithInheritance_Impl;\n' +
                'import org.finos.legend.pure.generated.Root_meta_protocols_generation_java_tests_model_scalar_Bool;\n' +
                'import org.finos.legend.pure.generated.Root_meta_protocols_generation_java_tests_model_scalar_Bool_Impl;\n' +
                'import org.finos.legend.pure.generated.Root_meta_protocols_generation_java_tests_model_scalar_Int32;\n' +
                'import org.finos.legend.pure.generated.Root_meta_protocols_generation_java_tests_model_scalar_Int32_Impl;\n' +
                'import org.finos.legend.pure.generated.Root_meta_protocols_generation_java_tests_model_scalar_String;\n' +
                'import org.finos.legend.pure.generated.Root_meta_protocols_generation_java_tests_model_scalar_String_Impl;\n' +
                'import org.finos.legend.pure.generated.Root_meta_protocols_generation_java_tests_model_store_Store;\n' +
                'import org.finos.legend.pure.generated.Root_meta_protocols_generation_java_tests_model_store_Store_Impl;\n' +
                'import org.finos.legend.pure.m4.coreinstance.CoreInstance;\n' +
                'import org.finos.meta.pure.metamodel.ReferenceUsage;\n' +
                'import org.finos.meta.pure.metamodel.extension.Stereotype;\n' +
                'import org.finos.meta.pure.metamodel.extension.TaggedValue;\n' +
                'import org.finos.pojo.PojoWithInheritance;\n' +
                'import org.finos.scalar.Bool;\n' +
                'import org.finos.scalar.Int32;\n' +
                'import org.finos.scalar.String;\n' +
                'import org.finos.store.Store;\n' +
                '\n' +
                'public class ProtocolToMetamodelTranslator\n' +
                '{\n' +
                '    public org.finos.legend.pure.m3.coreinstance.meta.pure.metamodel.type.Enum translate(FieldFlag fieldflag,\n' +
                '                                                                                         PureModel pureModel)\n' +
                '    {\n' +
                '        return fieldflag == null ? null\n' +
                '                                 : pureModel.getEnumValue("meta::protocols::generation::java::tests::model::FieldFlag",\n' +
                '                                                          fieldflag.name());\n' +
                '    }\n' +
                '\n' +
                '    public Root_meta_protocols_generation_java_tests_model_Enum translate(Enum _enum,\n' +
                '                                                                          PureModel pureModel)\n' +
                '    {\n' +
                '        return _enum == null ? null\n' +
                '                             : new Root_meta_protocols_generation_java_tests_model_Enum_Impl("",                                                                null,\n' +
                '                                                                                                                                                                pureModel.getType("meta::protocols::generation::java::tests::model::Enum"))\n' +
                '                                                                                                ._constant(_enum.constant)\n' +
                '                                                                                                ._constantNumber(_enum.constantNumber);\n' +
                '    }\n' +
                '\n' +
                '    public Root_meta_protocols_generation_java_tests_model_EnumPtr translate(EnumPtr enumptr,\n' +
                '                                                                             PureModel pureModel)\n' +
                '    {\n' +
                '        return enumptr == null ? null\n' +
                '                               : new Root_meta_protocols_generation_java_tests_model_EnumPtr_Impl("",                                                                   null,\n' +
                '                                                                                                                                                                        pureModel.getType("meta::protocols::generation::java::tests::model::EnumPtr"))\n' +
                '                                                                                                     ._name(enumptr.name);\n' +
                '    }\n' +
                '\n' +
                '    public Root_meta_protocols_generation_java_tests_model_Enumeration translate(Enumeration enumeration,\n' +
                '                                                                                 PureModel pureModel)\n' +
                '    {\n' +
                '        return enumeration == null ? null\n' +
                '                                   : new Root_meta_protocols_generation_java_tests_model_Enumeration_Impl("",                                                                       null,\n' +
                '                                                                                                                                                                                    pureModel.getType("meta::protocols::generation::java::tests::model::Enumeration"))\n' +
                '                                                                                                             ._name(enumeration.name)\n' +
                '                                                                                                             ._values(ListIterate.collect(enumeration.values == null\n' +
                '                                                                                                                                                     ? Collections.<Enum>emptyList()\n' +
                '                                                                                                                                                     : enumeration.values,\n' +
                '                                                                                                                                          (Enum x) -> this.translate(x, pureModel)));\n' +
                '    }\n' +
                '\n' +
                '    public Root_meta_protocols_generation_java_tests_model_Field translate(Field field,\n' +
                '                                                                           PureModel pureModel)\n' +
                '    {\n' +
                '        return field == null ? null\n' +
                '                             : new Root_meta_protocols_generation_java_tests_model_Field_Impl("",                                                                 null,\n' +
                '                                                                                                                                                                  pureModel.getType("meta::protocols::generation::java::tests::model::Field"))\n' +
                '                                                                                                 ._flag(this.translate(field.flag, pureModel))\n' +
                '                                                                                                 ._binaryFieldNumber(field.binaryFieldNumber)\n' +
                '                                                                                                 ._name(field.name)\n' +
                '                                                                                                 ._type(this.translate(field.type, pureModel))\n' +
                '                                                                                                 ._repeated(field.repeated);\n' +
                '    }\n' +
                '\n' +
                '    public Root_meta_protocols_generation_java_tests_model_Message translate(Message message,\n' +
                '                                                                             PureModel pureModel)\n' +
                '    {\n' +
                '        return message == null ? null\n' +
                '                               : new Root_meta_protocols_generation_java_tests_model_Message_Impl("",                                                                   null,\n' +
                '                                                                                                                                                                        pureModel.getType("meta::protocols::generation::java::tests::model::Message"))\n' +
                '                                                                                                     ._name(message.name)\n' +
                '                                                                                                     ._fields(ListIterate.collect(message.fields == null\n' +
                '                                                                                                                                         ? Collections.<Field>emptyList()\n' +
                '                                                                                                                                         : message.fields,\n' +
                '                                                                                                                                  (Field x) -> this.translate(x, pureModel)))\n' +
                '                                                                                                     ._reservedFieldNames(Lists.mutable.withAll(message.reservedFieldNames))\n' +
                '                                                                                                     ._reservedFieldNumbers(Lists.mutable.withAll(message.reservedFieldNumbers));\n' +
                '    }\n' +
                '\n' +
                '    public Root_meta_protocols_generation_java_tests_model_MessagePtr translate(MessagePtr messageptr,\n' +
                '                                                                                PureModel pureModel)\n' +
                '    {\n' +
                '        return messageptr == null ? null\n' +
                '                                  : new Root_meta_protocols_generation_java_tests_model_MessagePtr_Impl("",                                                                      null,\n' +
                '                                                                                                                                                                                 pureModel.getType("meta::protocols::generation::java::tests::model::MessagePtr"))\n' +
                '                                                                                                           ._name(messageptr.name);\n' +
                '    }\n' +
                '\n' +
                '    public Root_meta_protocols_generation_java_tests_model_ProtoBufType translate(ProtoBufType protobuftype,\n' +
                '                                                                                  PureModel pureModel)\n' +
                '    {\n' +
                '        return protobuftype == null ? null\n' +
                '                                    : protobuftype.accept(new ProtoBufTypeVisitor<Root_meta_protocols_generation_java_tests_model_ProtoBufType>()\n' +
                '        {\n' +
                '            public Root_meta_protocols_generation_java_tests_model_ProtoBufType visit(Bool val)\n' +
                '            {\n' +
                '                return ProtocolToMetamodelTranslator.this.translate(val, pureModel);\n' +
                '            }\n' +
                '            public Root_meta_protocols_generation_java_tests_model_ProtoBufType visit(EnumPtr val)\n' +
                '            {\n' +
                '                return ProtocolToMetamodelTranslator.this.translate(val, pureModel);\n' +
                '            }\n' +
                '            public Root_meta_protocols_generation_java_tests_model_ProtoBufType visit(Enumeration val)\n' +
                '            {\n' +
                '                return ProtocolToMetamodelTranslator.this.translate(val, pureModel);\n' +
                '            }\n' +
                '            public Root_meta_protocols_generation_java_tests_model_ProtoBufType visit(Int32 val)\n' +
                '            {\n' +
                '                return ProtocolToMetamodelTranslator.this.translate(val, pureModel);\n' +
                '            }\n' +
                '            public Root_meta_protocols_generation_java_tests_model_ProtoBufType visit(Message val)\n' +
                '            {\n' +
                '                return ProtocolToMetamodelTranslator.this.translate(val, pureModel);\n' +
                '            }\n' +
                '            public Root_meta_protocols_generation_java_tests_model_ProtoBufType visit(MessagePtr val)\n' +
                '            {\n' +
                '                return ProtocolToMetamodelTranslator.this.translate(val, pureModel);\n' +
                '            }\n' +
                '            public Root_meta_protocols_generation_java_tests_model_ProtoBufType visit(ScalarType val)\n' +
                '            {\n' +
                '                return ProtocolToMetamodelTranslator.this.translate(val, pureModel);\n' +
                '            }\n' +
                '            public Root_meta_protocols_generation_java_tests_model_ProtoBufType visit(String val)\n' +
                '            {\n' +
                '                return ProtocolToMetamodelTranslator.this.translate(val, pureModel);\n' +
                '            }\n' +
                '        });\n' +
                '    }\n' +
                '\n' +
                '    public Root_meta_protocols_generation_java_tests_model_ScalarType translate(ScalarType scalartype,\n' +
                '                                                                                PureModel pureModel)\n' +
                '    {\n' +
                '        return scalartype == null ? null\n' +
                '                                  : scalartype.accept(new ProtoBufTypeVisitor<Root_meta_protocols_generation_java_tests_model_ScalarType>()\n' +
                '        {\n' +
                '            public Root_meta_protocols_generation_java_tests_model_ScalarType visit(Bool val)\n' +
                '            {\n' +
                '                return ProtocolToMetamodelTranslator.this.translate(val, pureModel);\n' +
                '            }\n' +
                '            public Root_meta_protocols_generation_java_tests_model_ScalarType visit(EnumPtr val)\n' +
                '            {\n' +
                '                return null;\n' +
                '            }\n' +
                '            public Root_meta_protocols_generation_java_tests_model_ScalarType visit(Enumeration val)\n' +
                '            {\n' +
                '                return null;\n' +
                '            }\n' +
                '            public Root_meta_protocols_generation_java_tests_model_ScalarType visit(Int32 val)\n' +
                '            {\n' +
                '                return ProtocolToMetamodelTranslator.this.translate(val, pureModel);\n' +
                '            }\n' +
                '            public Root_meta_protocols_generation_java_tests_model_ScalarType visit(Message val)\n' +
                '            {\n' +
                '                return null;\n' +
                '            }\n' +
                '            public Root_meta_protocols_generation_java_tests_model_ScalarType visit(MessagePtr val)\n' +
                '            {\n' +
                '                return null;\n' +
                '            }\n' +
                '            public Root_meta_protocols_generation_java_tests_model_ScalarType visit(ScalarType val)\n' +
                '            {\n' +
                '                return scalartype == null ? null\n' +
                '                                          : new Root_meta_protocols_generation_java_tests_model_ScalarType_Impl("",\n' +
                '                                                                                                                null,\n' +
                '                                                                                                                pureModel.getType("meta::protocols::generation::java::tests::model::ScalarType"));\n' +
                '            }\n' +
                '            public Root_meta_protocols_generation_java_tests_model_ScalarType visit(String val)\n' +
                '            {\n' +
                '                return ProtocolToMetamodelTranslator.this.translate(val, pureModel);\n' +
                '            }\n' +
                '        });\n' +
                '    }\n' +
                '\n' +
                '    public Root_meta_protocols_generation_java_tests_model_pojo_PojoWithInheritance translate(PojoWithInheritance pojowithinheritance,\n' +
                '                                                                                              PureModel pureModel)\n' +
                '    {\n' +
                '        return pojowithinheritance == null ? null\n' +
                '                                           : new Root_meta_protocols_generation_java_tests_model_pojo_PojoWithInheritance_Impl("",                                                                                    null,\n' +
                '                                                                                                                                                                                                                      pureModel.getType("meta::protocols::generation::java::tests::model::pojo::PojoWithInheritance"))\n' +
                '                                                                                                                                  ._reqFactor(pojowithinheritance.reqFactor)\n' +
                '                                                                                                                                  ._optionalFactor(pojowithinheritance.optionalFactor);\n' +
                '    }\n' +
                '\n' +
                '    public Root_meta_protocols_generation_java_tests_model_scalar_Bool translate(Bool bool,\n' +
                '                                                                                 PureModel pureModel)\n' +
                '    {\n' +
                '        return bool == null ? null\n' +
                '                            : new Root_meta_protocols_generation_java_tests_model_scalar_Bool_Impl("",\n' +
                '                                                                                                   null,\n' +
                '                                                                                                   pureModel.getType("meta::protocols::generation::java::tests::model::scalar::Bool"));\n' +
                '    }\n' +
                '\n' +
                '    public Root_meta_protocols_generation_java_tests_model_scalar_Int32 translate(Int32 int32,\n' +
                '                                                                                  PureModel pureModel)\n' +
                '    {\n' +
                '        return int32 == null ? null\n' +
                '                             : new Root_meta_protocols_generation_java_tests_model_scalar_Int32_Impl("",\n' +
                '                                                                                                     null,\n' +
                '                                                                                                     pureModel.getType("meta::protocols::generation::java::tests::model::scalar::Int32"));\n' +
                '    }\n' +
                '\n' +
                '    public Root_meta_protocols_generation_java_tests_model_scalar_String translate(String string,\n' +
                '                                                                                   PureModel pureModel)\n' +
                '    {\n' +
                '        return string == null ? null\n' +
                '                              : new Root_meta_protocols_generation_java_tests_model_scalar_String_Impl("",\n' +
                '                                                                                                       null,\n' +
                '                                                                                                       pureModel.getType("meta::protocols::generation::java::tests::model::scalar::String"));\n' +
                '    }\n' +
                '\n' +
                '    public Root_meta_protocols_generation_java_tests_model_store_Store translate(Store store,\n' +
                '                                                                                 PureModel pureModel)\n' +
                '    {\n' +
                '        return store == null ? null\n' +
                '                             : new Root_meta_protocols_generation_java_tests_model_store_Store_Impl("",                                                                       null,\n' +
                '                                                                                                                                                                              pureModel.getType("meta::protocols::generation::java::tests::model::store::Store"))\n' +
                '                                                                                                       ._includes(ListIterate.collect(store.includes == null\n' +
                '                                                                                                                                           ? Collections.<org.finos.legend.engine.protocol.pure.v1.model.packageableElement.store.Store>emptyList()\n' +
                '                                                                                                                                           : store.includes,\n' +
                '                                                                                                                                      (org.finos.legend.engine.protocol.pure.v1.model.packageableElement.store.Store x) -> this.translate(x, pureModel)))\n' +
                '                                                                                                       ._package(this.translate(store._package, pureModel))\n' +
                '                                                                                                       ._name(store.name)\n' +
                '                                                                                                       ._stereotypes(ListIterate.collect(store.stereotypes == null\n' +
                '                                                                                                                                              ? Collections.<Stereotype>emptyList()\n' +
                '                                                                                                                                              : store.stereotypes,\n' +
                '                                                                                                                                         (Stereotype x) -> this.translate(x, pureModel)))\n' +
                '                                                                                                       ._taggedValues(ListIterate.collect(store.taggedValues == null\n' +
                '                                                                                                                                               ? Collections.<TaggedValue>emptyList()\n' +
                '                                                                                                                                               : store.taggedValues,\n' +
                '                                                                                                                                          (TaggedValue x) -> this.translate(x, pureModel)))\n' +
                '                                                                                                       ._referenceUsages(ListIterate.collect(store.referenceUsages == null\n' +
                '                                                                                                                                                  ? Collections.<ReferenceUsage>emptyList()\n' +
                '                                                                                                                                                  : store.referenceUsages,\n' +
                '                                                                                                                                             (ReferenceUsage x) -> this.translate(x, pureModel)));\n' +
                '    }\n' +
                '}', $sources->at(0));
}

function <<test.Test>> meta::protocols::generation::java::tests::testMetamodelToProtocolTranslatorJavaGeneration():Boolean[1]
{
  let config = ^meta::protocols::generation::java::translation::Configuration(
    purePackage = 'meta::protocols::generation::java::tests::model',
    javaPackage  = 'org.finos',
    elementsToBeExcluded = ['meta::protocols::generation::java::tests::model::pojo', 'meta::protocols::generation::java::tests::model::exclude', 'meta::protocols::generation::java::tests::model::store']
  )->meta::json::toJSON();

  let sources = meta::protocols::generation::java::translation::generateMetamodelToProtocolTranslation($config, [])->map(p | $p->meta::external::language::java::metamodel::project::allClasses()->map(cl | meta::external::language::java::serialization::newStringifier($p)->meta::external::language::java::serialization::ofClass($cl->meta::external::language::java::factory::inferImports())))->sort();
  assertEquals(1, $sources->size());
  assertEquals('package org.finos;\n' +
                '\n' +
                'import java.util.List;\n' +
                'import org.finos.legend.pure.generated.Root_meta_protocols_generation_java_tests_model_Enum;\n' +
                'import org.finos.legend.pure.generated.Root_meta_protocols_generation_java_tests_model_EnumPtr;\n' +
                'import org.finos.legend.pure.generated.Root_meta_protocols_generation_java_tests_model_Enumeration;\n' +
                'import org.finos.legend.pure.generated.Root_meta_protocols_generation_java_tests_model_Field;\n' +
                'import org.finos.legend.pure.generated.Root_meta_protocols_generation_java_tests_model_Message;\n' +
                'import org.finos.legend.pure.generated.Root_meta_protocols_generation_java_tests_model_MessagePtr;\n' +
                'import org.finos.legend.pure.generated.Root_meta_protocols_generation_java_tests_model_ProtoBufType;\n' +
                'import org.finos.legend.pure.generated.Root_meta_protocols_generation_java_tests_model_ScalarType;\n' +
                'import org.finos.legend.pure.generated.Root_meta_protocols_generation_java_tests_model_scalar_Bool;\n' +
                'import org.finos.legend.pure.generated.Root_meta_protocols_generation_java_tests_model_scalar_Int32;\n' +
                'import org.finos.legend.pure.generated.Root_meta_protocols_generation_java_tests_model_scalar_String;\n' +
                'import org.finos.scalar.Bool;\n' +
                'import org.finos.scalar.Int32;\n' +
                'import org.finos.scalar.String;\n' +
                '\n' +
                'public class MetamodelToProtocolTranslator\n' +
                '{\n' +
                '    public Bool translate(Root_meta_protocols_generation_java_tests_model_scalar_Bool bool)\n' +
                '    {\n' +
                '        if (bool == null)\n' +
                '        {\n' +
                '            return null;\n' +
                '        }\n' +
                '        Bool res = new Bool();\n' +
                '        return res;\n' +
                '    }\n' +
                '\n' +
                '    public Enum translate(Root_meta_protocols_generation_java_tests_model_Enum _enum)\n' +
                '    {\n' +
                '        if (_enum == null)\n' +
                '        {\n' +
                '            return null;\n' +
                '        }\n' +
                '        Enum res = new Enum();\n' +
                '        res.constant = _enum._constant();\n' +
                '        res.constantNumber = _enum._constantNumber();\n' +
                '        return res;\n' +
                '    }\n' +
                '\n' +
                '    public EnumPtr translate(Root_meta_protocols_generation_java_tests_model_EnumPtr enumptr)\n' +
                '    {\n' +
                '        if (enumptr == null)\n' +
                '        {\n' +
                '            return null;\n' +
                '        }\n' +
                '        EnumPtr res = new EnumPtr();\n' +
                '        res.name = enumptr._name();\n' +
                '        return res;\n' +
                '    }\n' +
                '\n' +
                '    public Enumeration translate(Root_meta_protocols_generation_java_tests_model_Enumeration enumeration)\n' +
                '    {\n' +
                '        if (enumeration == null)\n' +
                '        {\n' +
                '            return null;\n' +
                '        }\n' +
                '        Enumeration res = new Enumeration();\n' +
                '        res.name = enumeration._name();\n' +
                '        res.values = (List<Enum>) enumeration\n' +
                '           ._values()\n' +
                '           .collect((Root_meta_protocols_generation_java_tests_model_Enum x) -> this.translate(x))\n' +
                '           .toList();\n' +
                '        return res;\n' +
                '    }\n' +
                '\n' +
                '    public Field translate(Root_meta_protocols_generation_java_tests_model_Field field)\n' +
                '    {\n' +
                '        if (field == null)\n' +
                '        {\n' +
                '            return null;\n' +
                '        }\n' +
                '        Field res = new Field();\n' +
                '        res.flag = FieldFlag.valueOf(field._flag()._name());\n' +
                '        res.binaryFieldNumber = field._binaryFieldNumber();\n' +
                '        res.name = field._name();\n' +
                '        res.type = this.translate(field._type());\n' +
                '        res.repeated = field._repeated();\n' +
                '        return res;\n' +
                '    }\n' +
                '\n' +
                '    public Int32 translate(Root_meta_protocols_generation_java_tests_model_scalar_Int32 int32)\n' +
                '    {\n' +
                '        if (int32 == null)\n' +
                '        {\n' +
                '            return null;\n' +
                '        }\n' +
                '        Int32 res = new Int32();\n' +
                '        return res;\n' +
                '    }\n' +
                '\n' +
                '    public Message translate(Root_meta_protocols_generation_java_tests_model_Message message)\n' +
                '    {\n' +
                '        if (message == null)\n' +
                '        {\n' +
                '            return null;\n' +
                '        }\n' +
                '        Message res = new Message();\n' +
                '        res.name = message._name();\n' +
                '        res.fields = (List<Field>) message\n' +
                '           ._fields()\n' +
                '           .collect((Root_meta_protocols_generation_java_tests_model_Field x) -> this.translate(x))\n' +
                '           .toList();\n' +
                '        res.reservedFieldNames = (List<String>) message._reservedFieldNames().toList();\n' +
                '        res.reservedFieldNumbers = (List<Long>) message._reservedFieldNumbers().toList();\n' +
                '        return res;\n' +
                '    }\n' +
                '\n' +
                '    public MessagePtr translate(Root_meta_protocols_generation_java_tests_model_MessagePtr messageptr)\n' +
                '    {\n' +
                '        if (messageptr == null)\n' +
                '        {\n' +
                '            return null;\n' +
                '        }\n' +
                '        MessagePtr res = new MessagePtr();\n' +
                '        res.name = messageptr._name();\n' +
                '        return res;\n' +
                '    }\n' +
                '\n' +
                '    public ProtoBufType translate(Root_meta_protocols_generation_java_tests_model_ProtoBufType protobuftype)\n' +
                '    {\n' +
                '        if (protobuftype instanceof Root_meta_protocols_generation_java_tests_model_scalar_Bool)\n' +
                '        {\n' +
                '            return this.translate((Root_meta_protocols_generation_java_tests_model_scalar_Bool) protobuftype);\n' +
                '        }\n' +
                '        else if (protobuftype instanceof Root_meta_protocols_generation_java_tests_model_EnumPtr)\n' +
                '        {\n' +
                '            return this.translate((Root_meta_protocols_generation_java_tests_model_EnumPtr) protobuftype);\n' +
                '        }\n' +
                '        else if (protobuftype instanceof Root_meta_protocols_generation_java_tests_model_Enumeration)\n' +
                '        {\n' +
                '            return this.translate((Root_meta_protocols_generation_java_tests_model_Enumeration) protobuftype);\n' +
                '        }\n' +
                '        else if (protobuftype instanceof Root_meta_protocols_generation_java_tests_model_scalar_Int32)\n' +
                '        {\n' +
                '            return this.translate((Root_meta_protocols_generation_java_tests_model_scalar_Int32) protobuftype);\n' +
                '        }\n' +
                '        else if (protobuftype instanceof Root_meta_protocols_generation_java_tests_model_Message)\n' +
                '        {\n' +
                '            return this.translate((Root_meta_protocols_generation_java_tests_model_Message) protobuftype);\n' +
                '        }\n' +
                '        else if (protobuftype instanceof Root_meta_protocols_generation_java_tests_model_MessagePtr)\n' +
                '        {\n' +
                '            return this.translate((Root_meta_protocols_generation_java_tests_model_MessagePtr) protobuftype);\n' +
                '        }\n' +
                '        else if (protobuftype instanceof Root_meta_protocols_generation_java_tests_model_ScalarType)\n' +
                '        {\n' +
                '            return this.translate((Root_meta_protocols_generation_java_tests_model_ScalarType) protobuftype);\n' +
                '        }\n' +
                '        else if (protobuftype instanceof Root_meta_protocols_generation_java_tests_model_scalar_String)\n' +
                '        {\n' +
                '            return this.translate((Root_meta_protocols_generation_java_tests_model_scalar_String) protobuftype);\n' +
                '        }\n' +
                '        else\n' +
                '        {\n' +
                '            throw new IllegalStateException("Unknown data type");\n' +
                '        }\n' +
                '    }\n' +
                '\n' +
                '    public ScalarType translate(Root_meta_protocols_generation_java_tests_model_ScalarType scalartype)\n' +
                '    {\n' +
                '        if (scalartype instanceof Root_meta_protocols_generation_java_tests_model_scalar_Bool)\n' +
                '        {\n' +
                '            return this.translate((Root_meta_protocols_generation_java_tests_model_scalar_Bool) scalartype);\n' +
                '        }\n' +
                '        else if (scalartype instanceof Root_meta_protocols_generation_java_tests_model_scalar_Int32)\n' +
                '        {\n' +
                '            return this.translate((Root_meta_protocols_generation_java_tests_model_scalar_Int32) scalartype);\n' +
                '        }\n' +
                '        else if (scalartype instanceof Root_meta_protocols_generation_java_tests_model_scalar_String)\n' +
                '        {\n' +
                '            return this.translate((Root_meta_protocols_generation_java_tests_model_scalar_String) scalartype);\n' +
                '        }\n' +
                '        else\n' +
                '        {\n' +
                '            throw new IllegalStateException("Unknown data type");\n' +
                '        }\n' +
                '    }\n' +
                '\n' +
                '    public String translate(Root_meta_protocols_generation_java_tests_model_scalar_String string)\n' +
                '    {\n' +
                '        if (string == null)\n' +
                '        {\n' +
                '            return null;\n' +
                '        }\n' +
                '        String res = new String();\n' +
                '        return res;\n' +
                '    }\n' +
                '}', $sources->at(0));
}

function <<test.Test>> meta::protocols::generation::java::tests::testProtocolJavaGeneration():Boolean[1]
{
  let config = ^meta::protocols::generation::java::translation::Configuration(
    purePackage = 'meta::protocols::generation::java::tests::model',
    javaPackage  = 'org.finos',
    elementsToBeExcluded = 'meta::protocols::generation::java::tests::model::exclude'
  )->meta::json::toJSON();

  let dependency = ^meta::protocols::generation::java::translation::Configuration(
    purePackage = 'meta::protocols::generation::java::tests::provided::model::pojo',
    javaPackage  = 'org.finos.legend.engine.protocol.pure.v1.model.packageableElement'
  )->meta::json::toJSON();

  let sources = meta::protocols::generation::java::generateProtocolProject($config, $dependency)
        ->map(p | $p->meta::external::language::java::metamodel::project::allClasses()->sortBy(c | $c.simpleName)->map(cl | meta::external::language::java::serialization::newStringifier($p)->meta::external::language::java::serialization::ofClass($cl->meta::external::language::java::factory::inferImports())));

  assertEquals(15, $sources->size());

	assertEquals('package org.finos.scalar;\n' +
    '\n' +
		'import org.finos.ProtoBufTypeVisitor;\n' +
		'import org.finos.ScalarType;\n' +
    '\n' +
		'public class Bool extends ScalarType\n' +
		'{\n' +
		'    public <T> T accept(ProtoBufTypeVisitor<T> visitor)\n' +
		'    {\n' +
		'        return visitor.visit(this);\n' +
		'    }\n' +
		'}', $sources->at(0));

	assertEquals('package org.finos;\n' +
    '\n' +
		'public class Enum\n' +
		'{\n' +
		'    public String constant;\n' +
		'    public Long constantNumber;\n' +
    '\n' +
    '    public Enum _constant(String constant)\n' +
    '    {\n' +
    '        this.constant = constant;\n' +
    '        return this;\n' +
    '    }\n' +
    '\n' +
    '    public Enum _constantNumber(Long constantNumber)\n' +
    '    {\n' +
    '        this.constantNumber = constantNumber;\n' +
    '        return this;\n' +
    '    }\n' +
		'}', $sources->at(1));

    	assertEquals('package org.finos;\n' +
    '\n' +
		'public class EnumPtr extends ProtoBufType\n' +
		'{\n' +
		'    public String name;\n' +
    '\n' +
    '    public EnumPtr _name(String name)\n'+
    '    {\n'+
    '        this.name = name;\n'+
    '        return this;\n'+
    '    }\n'+
    '\n'+
		'    public <T> T accept(ProtoBufTypeVisitor<T> visitor)\n' +
		'    {\n' +
		'        return visitor.visit(this);\n' +
		'    }\n' +
		'}', $sources->at(2));

	assertEquals('package org.finos;\n' +
    '\n' +
		'import java.util.Collections;\n' +
		'import java.util.List;\n' +
    '\n' +
		'public class Enumeration extends ProtoBufType\n' +
		'{\n' +
		'    public String name;\n' +
		'    public List<Enum> values = Collections.<Enum>emptyList();\n' +
    '\n' +
    '    public Enumeration _name(String name)\n' +
    '    {\n' +
    '        this.name = name;\n' +
    '        return this;\n' +
    '    }\n' +
    '\n' +
    '    public Enumeration _values(List<Enum> values)\n' +
    '    {\n' +
    '        this.values = values;\n' +
    '        return this;\n' +
    '    }\n' +
    '\n' +
		'    public <T> T accept(ProtoBufTypeVisitor<T> visitor)\n' +
		'    {\n' +
		'        return visitor.visit(this);\n' +
		'    }\n' +
		'}', $sources->at(3));

	assertEquals('package org.finos;\n' +
    '\n' +
		'public class Field\n' +
		'{\n' +
		'    public FieldFlag flag;\n' +
		'    public Long binaryFieldNumber;\n' +
		'    public String name;\n' +
		'    public ProtoBufType type;\n' +
		'    public Boolean repeated;\n' +
    '\n' +
    '    public Field _flag(FieldFlag flag)\n' +
    '    {\n' +
    '        this.flag = flag;\n' +
    '        return this;\n' +
    '    }\n' +
    '\n' +
    '    public Field _binaryFieldNumber(Long binaryFieldNumber)\n' +
    '    {\n' +
    '        this.binaryFieldNumber = binaryFieldNumber;\n' +
    '        return this;\n' +
    '    }\n' +
    '\n' +
    '    public Field _name(String name)\n' +
    '    {\n' +
    '        this.name = name;\n' +
    '        return this;\n' +
    '    }\n' +
    '\n' +
    '    public Field _type(ProtoBufType type)\n' +
    '    {\n' +
    '        this.type = type;\n' +
    '        return this;\n' +
    '    }\n' +
    '\n' +
    '    public Field _repeated(Boolean repeated)\n' +
    '    {\n' +
    '        this.repeated = repeated;\n' +
    '        return this;\n' +
    '    }\n' +
		'}', $sources->at(4));



  assertEquals('package org.finos;\n' +
    '\n' +
		'public enum FieldFlag\n' +
		'{\n' +
		'    ON,\n' +
		'    OFF;\n' +
    '\n'+
    '    public String getName()\n'+
    '    {\n'+
    '        return this.name();\n'+
    '    }\n'+
    '\n'+
    '    public static FieldFlag getEnumFromPureName(String pureName)\n'+
    '    {\n'+
    '        return FieldFlag.valueOf(pureName);\n'+
    '    }\n'+
		'}', $sources->at(5));

	assertEquals('package org.finos.scalar;\n' +
    '\n' +
		'import org.finos.ProtoBufTypeVisitor;\n' +
		'import org.finos.ScalarType;\n' +
    '\n' +
		'public class Int32 extends ScalarType\n' +
		'{\n' +
		'    public <T> T accept(ProtoBufTypeVisitor<T> visitor)\n' +
		'    {\n' +
		'        return visitor.visit(this);\n' +
		'    }\n' +
		'}', $sources->at(6));

	assertEquals('package org.finos;\n' +
    '\n' +
		'import java.util.Collections;\n' +
		'import java.util.List;\n' +
    '\n' +
		'public class Message extends ProtoBufType\n' +
		'{\n' +
		'    public String name;\n' +
		'    public List<Field> fields = Collections.<Field>emptyList();\n' +
		'    public List<String> reservedFieldNames = Collections.<String>emptyList();\n' +
		'    public List<Long> reservedFieldNumbers = Collections.<Long>emptyList();\n' +
    '\n' +
    '    public Message _name(String name)\n' +
    '    {\n' +
    '        this.name = name;\n' +
    '        return this;\n' +
    '    }\n' +
    '\n' +
    '    public Message _fields(List<Field> fields)\n' +
    '    {\n' +
    '        this.fields = fields;\n' +
    '        return this;\n' +
    '    }\n' +
    '\n' +
    '    public Message _reservedFieldNames(List<String> reservedFieldNames)\n' +
    '    {\n' +
    '        this.reservedFieldNames = reservedFieldNames;\n' +
    '        return this;\n' +
    '    }\n' +
    '\n' +
    '    public Message _reservedFieldNumbers(List<Long> reservedFieldNumbers)\n' +
    '    {\n' +
    '        this.reservedFieldNumbers = reservedFieldNumbers;\n' +
    '        return this;\n' +
    '    }\n' +
    '\n' +
		'    public <T> T accept(ProtoBufTypeVisitor<T> visitor)\n' +
		'    {\n' +
		'        return visitor.visit(this);\n' +
		'    }\n' +
		'}', $sources->at(7));

	assertEquals('package org.finos;\n' +
    '\n' +
		'public class MessagePtr extends ProtoBufType\n' +
		'{\n' +
		'    public String name;\n' +
    '\n' +
    '    public MessagePtr _name(String name)\n' +
    '    {\n' +
    '        this.name = name;\n' +
    '        return this;\n' +
    '    }\n' +
    '\n' +
		'    public <T> T accept(ProtoBufTypeVisitor<T> visitor)\n' +
		'    {\n' +
		'        return visitor.visit(this);\n' +
		'    }\n' +
		'}', $sources->at(8));

	assertEquals('package org.finos.pojo;\n' +
    '\n' +
		'import org.finos.legend.engine.protocol.pure.v1.model.packageableElement.ProvidedPojo;\n' +
	  '\n' +
  	'public class PojoWithInheritance extends ProvidedPojo\n' +
		'{\n' +
		'    public Number reqFactor;\n' +
		'    public Number optionalFactor;\n' +
	  '\n' +
    '    public PojoWithInheritance _reqFactor(Number reqFactor)\n' +
    '    {\n' +
    '        this.reqFactor = reqFactor;\n' +
    '        return this;\n' +
    '    }\n' +
    '\n' +
    '    public PojoWithInheritance _optionalFactor(Number optionalFactor)\n' +
    '    {\n' +
    '        this.optionalFactor = optionalFactor;\n' +
    '        return this;\n' +
    '    }\n' + 
		'}', $sources->at(9));

	assertEquals('package org.finos;\n' +
    '\n' +
		'import com.fasterxml.jackson.annotation.JsonSubTypes;\n' +
		'import com.fasterxml.jackson.annotation.JsonTypeInfo;\n' +
    '\n' +
		'@JsonTypeInfo(use=JsonTypeInfo.Id.NAME, property="_type")\n' +
		'@JsonSubTypes({@JsonSubTypes.Type(value=org.finos.scalar.Bool.class, name="bool"), @JsonSubTypes.Type(value=org.finos.EnumPtr.class, name="enumPtr"), @JsonSubTypes.Type(value=org.finos.Enumeration.class, name="enumeration"), @JsonSubTypes.Type(value=org.finos.scalar.Int32.class, name="int32"), @JsonSubTypes.Type(value=org.finos.Message.class, name="message"), @JsonSubTypes.Type(value=org.finos.MessagePtr.class, name="messagePtr"), @JsonSubTypes.Type(value=org.finos.ScalarType.class, name="scalarType"), @JsonSubTypes.Type(value=org.finos.scalar.String.class, name="string")})\n' +
  	'public abstract class ProtoBufType\n' +
		'{\n' +
		'    public abstract <T> T accept(ProtoBufTypeVisitor<T> visitor);\n' +
		'}', $sources->at(10));

	assertEquals('package org.finos;\n' +
    '\n' +
		'import org.finos.scalar.Bool;\n' +
		'import org.finos.scalar.Int32;\n' +
		'import org.finos.scalar.String;\n' +
    '\n' +
		'public interface ProtoBufTypeVisitor<T>\n' +
		'{\n' +
		'    T visit(Bool val);\n' +
		'    T visit(EnumPtr val);\n' +
		'    T visit(Enumeration val);\n' +
		'    T visit(Int32 val);\n' +
		'    T visit(Message val);\n' +
		'    T visit(MessagePtr val);\n' +
		'    T visit(ScalarType val);\n' +
		'    T visit(String val);\n' +
		'}', $sources->at(11));

	assertEquals('package org.finos;\n' +
    '\n' +
		'public abstract class ScalarType extends ProtoBufType\n' +
		'{\n' +
		'    public abstract <T> T accept(ProtoBufTypeVisitor<T> visitor);\n' +
		'}', $sources->at(12));

	assertEquals('package org.finos.store;\n' +
    '\n' +
		'public class Store extends org.finos.legend.engine.protocol.pure.v1.model.packageableElement.store.Store\n' +
		'{\n' +
		'}', $sources->at(13));

	assertEquals('package org.finos.scalar;\n' +
    '\n' +
		'import org.finos.ProtoBufTypeVisitor;\n' +
		'import org.finos.ScalarType;\n' +
    '\n' +
		'public class String extends ScalarType\n' +
		'{\n' +
		'    public <T> T accept(ProtoBufTypeVisitor<T> visitor)\n' +
		'    {\n' +
		'        return visitor.visit(this);\n' +
		'    }\n' +
		'}', $sources->at(14));
}
