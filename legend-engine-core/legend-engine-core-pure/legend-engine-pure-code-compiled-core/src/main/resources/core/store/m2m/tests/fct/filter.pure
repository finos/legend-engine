import meta::pure::testCoverage::featureMatrix::*;
import meta::pure::test::fct::*;
import meta::pure::mapping::modelToModel::test::fct::*;
// Copyright 2025 Goldman Sachs
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

function <<MappingFeature.filter, meta::pure::test::fct::model::FCT.testCollection>> meta::pure::mapping::modelToModel::test::fct::mapping::filter::testFilterMapping():FCTMappingTest[1] 
{
 ^FCTMappingTest(setupData=  ^InstanceSetupData(instance= pair(S_Person, list([^S_Person(firstName='John',lastName='Doe',birthDate=%2020-02-02, firm=^S_Firm(legalName='Firm D')), ^S_Person(firstName='Joe',lastName='Smith',birthDate=%2010-02-02,firm=^S_Firm(legalName='Co',optionalDescription='Company'))]))->newMap()),
                 mapping =  meta::pure::mapping::modelToModel::test::fct::mapping::filter::filterMapping,
                 assertions= [
                              ^TestErrorAssertion(tests = [meta::pure::fct::tests::collection::filter::filterTDS__FunctionDefinition_1_,
                                                           meta::pure::fct::tests::collection::filter::filterAssociationTDS__FunctionDefinition_1_,
                                                           meta::pure::fct::tests::collection::distinct::distinctTDS__FunctionDefinition_1_,
                                                           meta::pure::fct::tests::collection::drop::dropTDS__FunctionDefinition_1_,
                                                           meta::pure::fct::tests::collection::exists::existsTDS__FunctionDefinition_1_,
                                                           meta::pure::fct::tests::collection::exists::existsRecursiveTDS__FunctionDefinition_1_,
                                                            meta::pure::fct::tests::collection::filter::filterAssociationIsEmptyTDS__FunctionDefinition_1_,
                                                            meta::pure::fct::tests::collection::filter::filterPropertyFromSuperTypeTDS__FunctionDefinition_1_,
                                                            meta::pure::fct::tests::collection::first::firstTDS__FunctionDefinition_1_,
                                                            meta::pure::fct::tests::collection::groupBy::groupByTDS__FunctionDefinition_1_,
                                                            meta::pure::fct::tests::collection::slice::sliceTDS__FunctionDefinition_1_,
                                                            meta::pure::fct::tests::collection::sort::sortAssociationTDS__FunctionDefinition_1_,
                                                            meta::pure::fct::tests::collection::sort::sortTDS__FunctionDefinition_1_,
                                                            meta::pure::fct::tests::collection::take::takeTDS__FunctionDefinition_1_     ],
                                                  expectedErrorMessage='Found unexpected connection type for TabularDataSet Query: JsonModelConnection'),
                             ^TestAssertion(tests = meta::pure::fct::tests::collection::filter::filterGraphFetch__FunctionDefinition_1_,
                                             expectedLineageResult= expectedLineage( ['Lambda', 'db_myDB', 'tb_myDBdefaultTRADE'],['Lambda', 'meta::pure::fct::tests::collection::Position', 'pack_meta::pure::fct::tests::collection'],'[Position.productID: [TRADE.productID <TableAliasColumn>]]'),
                                             expectedExecutionResult = ^JSONResult(value='{"builder":{"_type":"json"},"values":{"firstName":"Joe"}}')),
                            ^meta::pure::test::fct::TestAssertion(tests=meta::pure::fct::tests::collection::filter::filterAssociationGraphFetch__FunctionDefinition_1_,expectedExecutionResult=^meta::pure::test::fct::JSONResult(value='{"builder":{"_type":"json"},"values":[]}'),expectedLineageResult=meta::pure::test::fct::expectedLineage([], ['Lambda','meta::pure::fct::tests::collection::Firm','meta::pure::fct::tests::collection::Person','meta::pure::mapping::modelToModel::test::fct::S_Firm','meta::pure::mapping::modelToModel::test::fct::S_Person','pack_meta::pure::fct::tests::collection','pack_meta::pure::mapping::modelToModel::test::fct'], '[Person.firstName: []]')),
                              ^meta::pure::test::fct::TestAssertion(tests=meta::pure::fct::tests::collection::filter::filterAssociationIsEmptyGraphFetch__FunctionDefinition_1_,expectedExecutionResult=^meta::pure::test::fct::JSONResult(value='{"builder":{"_type":"json"},"values":{"firstName":"John"}}'),expectedLineageResult=meta::pure::test::fct::expectedLineage([], ['Lambda','meta::pure::fct::tests::collection::Firm','meta::pure::fct::tests::collection::Person','meta::pure::mapping::modelToModel::test::fct::S_Firm','meta::pure::mapping::modelToModel::test::fct::S_Person','pack_meta::pure::fct::tests::collection','pack_meta::pure::mapping::modelToModel::test::fct'], '[Person.firstName: []]'))

                           ]
            );

}
   



###Mapping
import meta::pure::fct::tests::collection::*;
import meta::pure::mapping::modelToModel::test::fct::*;
Mapping meta::pure::mapping::modelToModel::test::fct::mapping::filter::filterMapping
(


   Person : Pure
            {
               ~src S_Person
                 ~filter $src.firstName=='John'
                  firstName:$src.firstName,
                  lastName:$src.lastName,
                  description:$src.description,
                  birthDate:$src.birthDate,
                  firm:$src.firm,
                  address:$src.address
            }
            
  Address : Pure
            {
               ~src S_Address
                street:$src.street

            }   

   Firm : Pure
            {
               ~src S_Firm
                  legalName:$src.legalName,
                  optionalDescription:$src.optionalDescription,
                  employees:$src.employees
            }


)

