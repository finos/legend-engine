// Copyright 2021 Goldman Sachs
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

###Pure
import meta::relational::functions::sqlQueryToString::h2::*;
import meta::core::runtime::*;
import meta::relational::functions::asserts::*;
import meta::relational::mapping::*;
import meta::relational::tests::*;
import meta::external::store::relational::tests::*;
import meta::relational::tests::milestoning::*;
import meta::relational::tests::milestoning::union::*;

function <<test.Test>> meta::relational::tests::milestoning::union::testHybridMilestoningUnionOperationWithNonTemporalRoot():Boolean[1]
{
   let result = execute(|Order.all()->filter(o|$o.biTemporalProduct(%2015-8-25, %2018-8-26).name == 'ProductName1'), hybridMilestoningUnionMap, meta::external::store::relational::tests::testRuntime(), meta::relational::extension::relationalExtensions());
   assertEquals(
    'select "unionBase".u_type as u_type, "unionBase"."pk_0_0" as "pk_0_0", "unionBase"."pk_0_1" as "pk_0_1", "unionBase"."pk_0_2" as "pk_0_2", "unionBase"."pk_0_3" as "pk_0_3", "unionBase"."pk_0_4" as "pk_0_4", "unionBase"."pk_0_5" as "pk_0_5", "unionBase"."id" as "id" from (select \'0\' as u_type, "root".id as "pk_0_0", null as "pk_0_1", null as "pk_0_2", null as "pk_0_3", null as "pk_0_4", null as "pk_0_5", "root".id as "id", "root".prodFk as prodFk_0, null as prodFk_1, null as prodFk_2, null as prodFk_3, null as prodFk_4, null as prodFk_5 from OrderTable as "root" union all select \'1\' as u_type, null as "pk_0_0", "root".id as "pk_0_1", null as "pk_0_2", null as "pk_0_3", null as "pk_0_4", null as "pk_0_5", "root".id as "id", null as prodFk_0, "root".prodFk as prodFk_1, null as prodFk_2, null as prodFk_3, null as prodFk_4, null as prodFk_5 from OrderTable as "root" union all select \'2\' as u_type, null as "pk_0_0", null as "pk_0_1", "root".id as "pk_0_2", null as "pk_0_3", null as "pk_0_4", null as "pk_0_5", "root".id as "id", null as prodFk_0, null as prodFk_1, "root".prodFk as prodFk_2, null as prodFk_3, null as prodFk_4, null as prodFk_5 from OrderTable as "root" union all select \'3\' as u_type, null as "pk_0_0", null as "pk_0_1", null as "pk_0_2", "root".id as "pk_0_3", null as "pk_0_4", null as "pk_0_5", "root".id as "id", null as prodFk_0, null as prodFk_1, null as prodFk_2, "root".prodFk as prodFk_3, null as prodFk_4, null as prodFk_5 from OrderTable as "root" union all select \'4\' as u_type, null as "pk_0_0", null as "pk_0_1", null as "pk_0_2", null as "pk_0_3", "root".id as "pk_0_4", null as "pk_0_5", "root".id as "id", null as prodFk_0, null as prodFk_1, null as prodFk_2, null as prodFk_3, "root".prodFk as prodFk_4, null as prodFk_5 from OrderTable as "root" union all select \'5\' as u_type, null as "pk_0_0", null as "pk_0_1", null as "pk_0_2", null as "pk_0_3", null as "pk_0_4", "root".id as "pk_0_5", "root".id as "id", null as prodFk_0, null as prodFk_1, null as prodFk_2, null as prodFk_3, null as prodFk_4, "root".prodFk as prodFk_5 from OrderTable as "root") as "unionBase" left outer join (select "root".from_z as "from_z_0", "root".thru_z as "thru_z_0", null as "snapshotDate_1", null as "in_z_2", null as "out_z_2", null as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", "root".id as id, "root".name as "BiTemporalProductTableWithBusinessMilestoningname_BiTemporalProductTableWithBusinessSnapshotMilestoningname_BiTemporalProductTableWithProcessingMilestoningname_BiTemporalProductTableWithProcessingSnapshotMilestoningname_B___168fffa0c7bca6e727f89b_0" from BiTemporalProductTableWithBusinessMilestoning as "root" where "root".from_z <= DATE\'2018-08-26\' and "root".thru_z > DATE\'2018-08-26\' union all select null as "from_z_0", null as "thru_z_0", "root".snapshotDate as "snapshotDate_1", null as "in_z_2", null as "out_z_2", null as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", "root".id as id, "root".name as "BiTemporalProductTableWithBusinessMilestoningname_BiTemporalProductTableWithBusinessSnapshotMilestoningname_BiTemporalProductTableWithProcessingMilestoningname_BiTemporalProductTableWithProcessingSnapshotMilestoningname_B___168fffa0c7bca6e727f89b_0" from BiTemporalProductTableWithBusinessSnapshotMilestoning as "root" where "root".snapshotDate = DATE\'2018-08-26\' union all select null as "from_z_0", null as "thru_z_0", null as "snapshotDate_1", "root".in_z as "in_z_2", "root".out_z as "out_z_2", null as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", "root".id as id, "root".name as "BiTemporalProductTableWithBusinessMilestoningname_BiTemporalProductTableWithBusinessSnapshotMilestoningname_BiTemporalProductTableWithProcessingMilestoningname_BiTemporalProductTableWithProcessingSnapshotMilestoningname_B___168fffa0c7bca6e727f89b_0" from BiTemporalProductTableWithProcessingMilestoning as "root" where "root".in_z <= DATE\'2015-08-25\' and "root".out_z > DATE\'2015-08-25\' union all select null as "from_z_0", null as "thru_z_0", null as "snapshotDate_1", null as "in_z_2", null as "out_z_2", "root".snapshotDate as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", "root".id as id, "root".name as "BiTemporalProductTableWithBusinessMilestoningname_BiTemporalProductTableWithBusinessSnapshotMilestoningname_BiTemporalProductTableWithProcessingMilestoningname_BiTemporalProductTableWithProcessingSnapshotMilestoningname_B___168fffa0c7bca6e727f89b_0" from BiTemporalProductTableWithProcessingSnapshotMilestoning as "root" where "root".snapshotDate = DATE\'2015-08-25\' union all select null as "from_z_0", null as "thru_z_0", null as "snapshotDate_1", null as "in_z_2", null as "out_z_2", null as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", "root".id as id, "root".name as "BiTemporalProductTableWithBusinessMilestoningname_BiTemporalProductTableWithBusinessSnapshotMilestoningname_BiTemporalProductTableWithProcessingMilestoningname_BiTemporalProductTableWithProcessingSnapshotMilestoningname_B___168fffa0c7bca6e727f89b_0" from BiTemporalProductTableWithNoMilestoning as "root" union all select null as "from_z_0", null as "thru_z_0", null as "snapshotDate_1", null as "in_z_2", null as "out_z_2", null as "snapshotDate_3", "root".from_z as "from_z_5", "root".thru_z as "thru_z_5", "root".snapshotDate as "snapshotDate_5", "root".id as id, "root".name as "BiTemporalProductTableWithBusinessMilestoningname_BiTemporalProductTableWithBusinessSnapshotMilestoningname_BiTemporalProductTableWithProcessingMilestoningname_BiTemporalProductTableWithProcessingSnapshotMilestoningname_B___168fffa0c7bca6e727f89b_0" from BiTemporalProductTableWithBiTemporalMilestoning as "root" where "root".snapshotDate = DATE\'2015-08-25\' and "root".from_z <= DATE\'2018-08-26\' and "root".thru_z > DATE\'2018-08-26\') as "unionalias_1" on (("unionBase".prodFk_0 = "unionalias_1".id or "unionBase".prodFk_1 = "unionalias_1".id or "unionBase".prodFk_2 = "unionalias_1".id or "unionBase".prodFk_3 = "unionalias_1".id or "unionBase".prodFk_4 = "unionalias_1".id or "unionBase".prodFk_5 = "unionalias_1".id) and (("unionalias_1"."in_z_2" <= DATE\'2015-08-25\' and "unionalias_1"."out_z_2" > DATE\'2015-08-25\') or coalesce("unionalias_1"."in_z_2", "unionalias_1"."out_z_2") is null) and (coalesce("unionalias_1"."snapshotDate_3", "unionalias_1"."snapshotDate_5") = DATE\'2015-08-25\' or coalesce("unionalias_1"."snapshotDate_3", "unionalias_1"."snapshotDate_5") is null) and ((coalesce("unionalias_1"."from_z_0", "unionalias_1"."from_z_5") <= DATE\'2018-08-26\' and coalesce("unionalias_1"."thru_z_0", "unionalias_1"."thru_z_5") > DATE\'2018-08-26\') or coalesce("unionalias_1"."from_z_0", "unionalias_1"."from_z_5", "unionalias_1"."thru_z_0", "unionalias_1"."thru_z_5") is null) and ("unionalias_1"."snapshotDate_1" = DATE\'2018-08-26\' or "unionalias_1"."snapshotDate_1" is null)) where "unionalias_1"."BiTemporalProductTableWithBusinessMilestoningname_BiTemporalProductTableWithBusinessSnapshotMilestoningname_BiTemporalProductTableWithProcessingMilestoningname_BiTemporalProductTableWithProcessingSnapshotMilestoningname_B___168fffa0c7bca6e727f89b_0" = \'ProductName1\'',
    $result->sqlRemoveFormatting()
   );
   assertEquals([1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1 , 1], $result.values.id);
}

/*
FIXME: Inflow execution vs plan generation do not perform the same table alias trimming.
If a table alias is hashed, we also add an index to the end for plan execution ONLY eg: hash_0
but for non-hashed names we leave the fully-qualified name for plan execution and in-flow.
*/
function <<test.Test, test.AlloyOnly>> meta::relational::tests::milestoning::union::testPlanHybridMilestoningUnionOperationWithNonTemporalRootWithPropagation():Boolean[1]
{
   testHybridMilestoningUnionOperationWithNonTemporalRootWithPropagation([
     'BiTemporalProductClassificationTableWithBusinessMilestoningtype_description_BiTemporalProductClassificationTableWithBusinessSnapshotMilestoningtype_description_BiTemporalProductClassificationTableWithProcessingMilestoning___c88f893dbce2fa7329ae22_0'
   ]->repeat(5));
}

function <<test.Test, test.ExcludeAlloy>> meta::relational::tests::milestoning::union::testInFlowHybridMilestoningUnionOperationWithNonTemporalRootWithPropagation():Boolean[1]
{
   let tableName = [
    'BiTemporalProductClassificationTableWithBusinessMilestoningtype_description_BiTemporalProductClassificationTableWithBusinessSnapshotMilestoningtype_description_BiTemporalProductClassificationTableWithProcessingMilestoning___c88f893dbce2fa7329ae22_0'

   ]->repeat(5);
   let result = execute(|Order.all()->filter(o|$o.biTemporalProduct(%2015-8-25, %2018-8-26).biTemporalClassification.description == 'STOCK DESC-V2'), hybridMilestoningUnionMap, meta::external::store::relational::tests::testRuntime(), meta::relational::extension::relationalExtensions());
   assertEquals(
    'select "unionBase".u_type as u_type, "unionBase"."pk_0_0" as "pk_0_0", "unionBase"."pk_0_1" as "pk_0_1", "unionBase"."pk_0_2" as "pk_0_2", "unionBase"."pk_0_3" as "pk_0_3", "unionBase"."pk_0_4" as "pk_0_4", "unionBase"."pk_0_5" as "pk_0_5", "unionBase"."id" as "id" from (select \'0\' as u_type, "root".id as "pk_0_0", null as "pk_0_1", null as "pk_0_2", null as "pk_0_3", null as "pk_0_4", null as "pk_0_5", "root".id as "id", "root".prodFk as prodFk_0, null as prodFk_1, null as prodFk_2, null as prodFk_3, null as prodFk_4, null as prodFk_5 from OrderTable as "root" union all select \'1\' as u_type, null as "pk_0_0", "root".id as "pk_0_1", null as "pk_0_2", null as "pk_0_3", null as "pk_0_4", null as "pk_0_5", "root".id as "id", null as prodFk_0, "root".prodFk as prodFk_1, null as prodFk_2, null as prodFk_3, null as prodFk_4, null as prodFk_5 from OrderTable as "root" union all select \'2\' as u_type, null as "pk_0_0", null as "pk_0_1", "root".id as "pk_0_2", null as "pk_0_3", null as "pk_0_4", null as "pk_0_5", "root".id as "id", null as prodFk_0, null as prodFk_1, "root".prodFk as prodFk_2, null as prodFk_3, null as prodFk_4, null as prodFk_5 from OrderTable as "root" union all select \'3\' as u_type, null as "pk_0_0", null as "pk_0_1", null as "pk_0_2", "root".id as "pk_0_3", null as "pk_0_4", null as "pk_0_5", "root".id as "id", null as prodFk_0, null as prodFk_1, null as prodFk_2, "root".prodFk as prodFk_3, null as prodFk_4, null as prodFk_5 from OrderTable as "root" union all select \'4\' as u_type, null as "pk_0_0", null as "pk_0_1", null as "pk_0_2", null as "pk_0_3", "root".id as "pk_0_4", null as "pk_0_5", "root".id as "id", null as prodFk_0, null as prodFk_1, null as prodFk_2, null as prodFk_3, "root".prodFk as prodFk_4, null as prodFk_5 from OrderTable as "root" union all select \'5\' as u_type, null as "pk_0_0", null as "pk_0_1", null as "pk_0_2", null as "pk_0_3", null as "pk_0_4", "root".id as "pk_0_5", "root".id as "id", null as prodFk_0, null as prodFk_1, null as prodFk_2, null as prodFk_3, null as prodFk_4, "root".prodFk as prodFk_5 from OrderTable as "root") as "unionBase" left outer join (select "root".from_z as "from_z_0", "root".thru_z as "thru_z_0", null as "snapshotDate_1", null as "in_z_2", null as "out_z_2", null as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", "root".id as id, "root".type as type_0, null as type_1, null as type_2, null as type_3, null as type_4, null as type_5 from BiTemporalProductTableWithBusinessMilestoning as "root" where "root".from_z <= DATE\'2018-08-26\' and "root".thru_z > DATE\'2018-08-26\' union all select null as "from_z_0", null as "thru_z_0", "root".snapshotDate as "snapshotDate_1", null as "in_z_2", null as "out_z_2", null as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", "root".id as id, null as type_0, "root".type as type_1, null as type_2, null as type_3, null as type_4, null as type_5 from BiTemporalProductTableWithBusinessSnapshotMilestoning as "root" where "root".snapshotDate = DATE\'2018-08-26\' union all select null as "from_z_0", null as "thru_z_0", null as "snapshotDate_1", "root".in_z as "in_z_2", "root".out_z as "out_z_2", null as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", "root".id as id, null as type_0, null as type_1, "root".type as type_2, null as type_3, null as type_4, null as type_5 from BiTemporalProductTableWithProcessingMilestoning as "root" where "root".in_z <= DATE\'2015-08-25\' and "root".out_z > DATE\'2015-08-25\' union all select null as "from_z_0", null as "thru_z_0", null as "snapshotDate_1", null as "in_z_2", null as "out_z_2", "root".snapshotDate as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", "root".id as id, null as type_0, null as type_1, null as type_2, "root".type as type_3, null as type_4, null as type_5 from BiTemporalProductTableWithProcessingSnapshotMilestoning as "root" where "root".snapshotDate = DATE\'2015-08-25\' union all select null as "from_z_0", null as "thru_z_0", null as "snapshotDate_1", null as "in_z_2", null as "out_z_2", null as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", "root".id as id, null as type_0, null as type_1, null as type_2, null as type_3, "root".type as type_4, null as type_5 from BiTemporalProductTableWithNoMilestoning as "root" union all select null as "from_z_0", null as "thru_z_0", null as "snapshotDate_1", null as "in_z_2", null as "out_z_2", null as "snapshotDate_3", "root".from_z as "from_z_5", "root".thru_z as "thru_z_5", "root".snapshotDate as "snapshotDate_5", "root".id as id, null as type_0, null as type_1, null as type_2, null as type_3, null as type_4, "root".type as type_5 from BiTemporalProductTableWithBiTemporalMilestoning as "root" where "root".snapshotDate = DATE\'2015-08-25\' and "root".from_z <= DATE\'2018-08-26\' and "root".thru_z > DATE\'2018-08-26\') as "unionalias_1" on (("unionBase".prodFk_0 = "unionalias_1".id or "unionBase".prodFk_1 = "unionalias_1".id or "unionBase".prodFk_2 = "unionalias_1".id or "unionBase".prodFk_3 = "unionalias_1".id or "unionBase".prodFk_4 = "unionalias_1".id or "unionBase".prodFk_5 = "unionalias_1".id) and (("unionalias_1"."in_z_2" <= DATE\'2015-08-25\' and "unionalias_1"."out_z_2" > DATE\'2015-08-25\') or coalesce("unionalias_1"."in_z_2", "unionalias_1"."out_z_2") is null) and (coalesce("unionalias_1"."snapshotDate_3", "unionalias_1"."snapshotDate_5") = DATE\'2015-08-25\' or coalesce("unionalias_1"."snapshotDate_3", "unionalias_1"."snapshotDate_5") is null) and ((coalesce("unionalias_1"."from_z_0", "unionalias_1"."from_z_5") <= DATE\'2018-08-26\' and coalesce("unionalias_1"."thru_z_0", "unionalias_1"."thru_z_5") > DATE\'2018-08-26\') or coalesce("unionalias_1"."from_z_0", "unionalias_1"."from_z_5", "unionalias_1"."thru_z_0", "unionalias_1"."thru_z_5") is null) and ("unionalias_1"."snapshotDate_1" = DATE\'2018-08-26\' or "unionalias_1"."snapshotDate_1" is null)) left outer join (select "root".from_z as "from_z_0", "root".thru_z as "thru_z_0", null as "snapshotDate_1", null as "in_z_2", null as "out_z_2", null as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", "root".type as type, "root".type_description as "BiTemporalProductClassificationTableWithBusinessMilestoningtype_description_BiTemporalProductClassificationTableWithBusinessSnapshotMilestoningtype_description_BiTemporalProductClassificationTableWithProcessingMilestoning___5192ab2dc5823f50357032_0" from BiTemporalProductClassificationTableWithBusinessMilestoning as "root" where "root".from_z <= DATE\'2018-08-26\' and "root".thru_z > DATE\'2018-08-26\' union all select null as "from_z_0", null as "thru_z_0", "root".snapshotDate as "snapshotDate_1", null as "in_z_2", null as "out_z_2", null as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", "root".type as type, "root".type_description as "BiTemporalProductClassificationTableWithBusinessMilestoningtype_description_BiTemporalProductClassificationTableWithBusinessSnapshotMilestoningtype_description_BiTemporalProductClassificationTableWithProcessingMilestoning___5192ab2dc5823f50357032_0" from BiTemporalProductClassificationTableWithBusinessSnapshotMilestoning as "root" where "root".snapshotDate = DATE\'2018-08-26\' union all select null as "from_z_0", null as "thru_z_0", null as "snapshotDate_1", "root".in_z as "in_z_2", "root".out_z as "out_z_2", null as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", "root".type as type, "root".type_description as "BiTemporalProductClassificationTableWithBusinessMilestoningtype_description_BiTemporalProductClassificationTableWithBusinessSnapshotMilestoningtype_description_BiTemporalProductClassificationTableWithProcessingMilestoning___5192ab2dc5823f50357032_0" from BiTemporalProductClassificationTableWithProcessingMilestoning as "root" where "root".in_z <= DATE\'2015-08-25\' and "root".out_z > DATE\'2015-08-25\' union all select null as "from_z_0", null as "thru_z_0", null as "snapshotDate_1", null as "in_z_2", null as "out_z_2", "root".snapshotDate as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", "root".type as type, "root".type_description as "BiTemporalProductClassificationTableWithBusinessMilestoningtype_description_BiTemporalProductClassificationTableWithBusinessSnapshotMilestoningtype_description_BiTemporalProductClassificationTableWithProcessingMilestoning___5192ab2dc5823f50357032_0" from BiTemporalProductClassificationTableWithProcessingSnapshotMilestoning as "root" where "root".snapshotDate = DATE\'2015-08-25\' union all select null as "from_z_0", null as "thru_z_0", null as "snapshotDate_1", null as "in_z_2", null as "out_z_2", null as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", "root".type as type, "root".type_description as "BiTemporalProductClassificationTableWithBusinessMilestoningtype_description_BiTemporalProductClassificationTableWithBusinessSnapshotMilestoningtype_description_BiTemporalProductClassificationTableWithProcessingMilestoning___5192ab2dc5823f50357032_0" from BiTemporalProductClassificationTableWithNoMilestoning as "root" union all select null as "from_z_0", null as "thru_z_0", null as "snapshotDate_1", null as "in_z_2", null as "out_z_2", null as "snapshotDate_3", "root".from_z as "from_z_5", "root".thru_z as "thru_z_5", "root".snapshotDate as "snapshotDate_5", "root".type as type, "root".type_description as "BiTemporalProductClassificationTableWithBusinessMilestoningtype_description_BiTemporalProductClassificationTableWithBusinessSnapshotMilestoningtype_description_BiTemporalProductClassificationTableWithProcessingMilestoning___5192ab2dc5823f50357032_0" from BiTemporalProductClassificationTableWithBiTemporalMilestoning as "root" where "root".snapshotDate = DATE\'2015-08-25\' and "root".from_z <= DATE\'2018-08-26\' and "root".thru_z > DATE\'2018-08-26\') as "unionalias_2" on (("unionalias_1".type_0 = "unionalias_2".type or "unionalias_1".type_1 = "unionalias_2".type or "unionalias_1".type_2 = "unionalias_2".type or "unionalias_1".type_3 = "unionalias_2".type or "unionalias_1".type_4 = "unionalias_2".type or "unionalias_1".type_5 = "unionalias_2".type) and (("unionalias_2"."in_z_2" <= DATE\'2015-08-25\' and "unionalias_2"."out_z_2" > DATE\'2015-08-25\') or coalesce("unionalias_2"."in_z_2", "unionalias_2"."out_z_2") is null) and (coalesce("unionalias_2"."snapshotDate_3", "unionalias_2"."snapshotDate_5") = DATE\'2015-08-25\' or coalesce("unionalias_2"."snapshotDate_3", "unionalias_2"."snapshotDate_5") is null) and ((coalesce("unionalias_2"."from_z_0", "unionalias_2"."from_z_5") <= DATE\'2018-08-26\' and coalesce("unionalias_2"."thru_z_0", "unionalias_2"."thru_z_5") > DATE\'2018-08-26\') or coalesce("unionalias_2"."from_z_0", "unionalias_2"."from_z_5", "unionalias_2"."thru_z_0", "unionalias_2"."thru_z_5") is null) and ("unionalias_2"."snapshotDate_1" = DATE\'2018-08-26\' or "unionalias_2"."snapshotDate_1" is null)) where "unionalias_2"."BiTemporalProductClassificationTableWithBusinessMilestoningtype_description_BiTemporalProductClassificationTableWithBusinessSnapshotMilestoningtype_description_BiTemporalProductClassificationTableWithProcessingMilestoning___5192ab2dc5823f50357032_0" = \'STOCK DESC-V2\'',  
    $result->sqlRemoveFormatting()
   );
   assertEquals([1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], $result.values.id);

}

function <<access.private>> meta::relational::tests::milestoning::union::testHybridMilestoningUnionOperationWithNonTemporalRootWithPropagation(
  tableNames: String[*]
): Boolean[1]
{
   let result = execute(|Order.all()->filter(o|$o.biTemporalProduct(%2015-8-25, %2018-8-26).biTemporalClassification.description == 'STOCK DESC-V2'), hybridMilestoningUnionMap, meta::external::store::relational::tests::testRuntime(), meta::relational::extension::relationalExtensions());
   assertEquals(
    'select "unionBase".u_type as u_type, "unionBase"."pk_0_0" as "pk_0_0", "unionBase"."pk_0_1" as "pk_0_1", "unionBase"."pk_0_2" as "pk_0_2", "unionBase"."pk_0_3" as "pk_0_3", "unionBase"."pk_0_4" as "pk_0_4", "unionBase"."pk_0_5" as "pk_0_5", "unionBase"."id" as "id" from (select \'0\' as u_type, "root".id as "pk_0_0", null as "pk_0_1", null as "pk_0_2", null as "pk_0_3", null as "pk_0_4", null as "pk_0_5", "root".id as "id", "root".prodFk as prodFk_0, null as prodFk_1, null as prodFk_2, null as prodFk_3, null as prodFk_4, null as prodFk_5 from OrderTable as "root" union all select \'1\' as u_type, null as "pk_0_0", "root".id as "pk_0_1", null as "pk_0_2", null as "pk_0_3", null as "pk_0_4", null as "pk_0_5", "root".id as "id", null as prodFk_0, "root".prodFk as prodFk_1, null as prodFk_2, null as prodFk_3, null as prodFk_4, null as prodFk_5 from OrderTable as "root" union all select \'2\' as u_type, null as "pk_0_0", null as "pk_0_1", "root".id as "pk_0_2", null as "pk_0_3", null as "pk_0_4", null as "pk_0_5", "root".id as "id", null as prodFk_0, null as prodFk_1, "root".prodFk as prodFk_2, null as prodFk_3, null as prodFk_4, null as prodFk_5 from OrderTable as "root" union all select \'3\' as u_type, null as "pk_0_0", null as "pk_0_1", null as "pk_0_2", "root".id as "pk_0_3", null as "pk_0_4", null as "pk_0_5", "root".id as "id", null as prodFk_0, null as prodFk_1, null as prodFk_2, "root".prodFk as prodFk_3, null as prodFk_4, null as prodFk_5 from OrderTable as "root" union all select \'4\' as u_type, null as "pk_0_0", null as "pk_0_1", null as "pk_0_2", null as "pk_0_3", "root".id as "pk_0_4", null as "pk_0_5", "root".id as "id", null as prodFk_0, null as prodFk_1, null as prodFk_2, null as prodFk_3, "root".prodFk as prodFk_4, null as prodFk_5 from OrderTable as "root" union all select \'5\' as u_type, null as "pk_0_0", null as "pk_0_1", null as "pk_0_2", null as "pk_0_3", null as "pk_0_4", "root".id as "pk_0_5", "root".id as "id", null as prodFk_0, null as prodFk_1, null as prodFk_2, null as prodFk_3, null as prodFk_4, "root".prodFk as prodFk_5 from OrderTable as "root") as "unionBase" left outer join (select "root".from_z as "from_z_0", "root".thru_z as "thru_z_0", null as "snapshotDate_1", null as "in_z_2", null as "out_z_2", null as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", "root".id as id, "root".type as type_0, null as type_1, null as type_2, null as type_3, null as type_4, null as type_5 from BiTemporalProductTableWithBusinessMilestoning as "root" where "root".from_z <= DATE\'2018-08-26\' and "root".thru_z > DATE\'2018-08-26\' union all select null as "from_z_0", null as "thru_z_0", "root".snapshotDate as "snapshotDate_1", null as "in_z_2", null as "out_z_2", null as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", "root".id as id, null as type_0, "root".type as type_1, null as type_2, null as type_3, null as type_4, null as type_5 from BiTemporalProductTableWithBusinessSnapshotMilestoning as "root" where "root".snapshotDate = DATE\'2018-08-26\' union all select null as "from_z_0", null as "thru_z_0", null as "snapshotDate_1", "root".in_z as "in_z_2", "root".out_z as "out_z_2", null as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", "root".id as id, null as type_0, null as type_1, "root".type as type_2, null as type_3, null as type_4, null as type_5 from BiTemporalProductTableWithProcessingMilestoning as "root" where "root".in_z <= DATE\'2015-08-25\' and "root".out_z > DATE\'2015-08-25\' union all select null as "from_z_0", null as "thru_z_0", null as "snapshotDate_1", null as "in_z_2", null as "out_z_2", "root".snapshotDate as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", "root".id as id, null as type_0, null as type_1, null as type_2, "root".type as type_3, null as type_4, null as type_5 from BiTemporalProductTableWithProcessingSnapshotMilestoning as "root" where "root".snapshotDate = DATE\'2015-08-25\' union all select null as "from_z_0", null as "thru_z_0", null as "snapshotDate_1", null as "in_z_2", null as "out_z_2", null as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", "root".id as id, null as type_0, null as type_1, null as type_2, null as type_3, "root".type as type_4, null as type_5 from BiTemporalProductTableWithNoMilestoning as "root" union all select null as "from_z_0", null as "thru_z_0", null as "snapshotDate_1", null as "in_z_2", null as "out_z_2", null as "snapshotDate_3", "root".from_z as "from_z_5", "root".thru_z as "thru_z_5", "root".snapshotDate as "snapshotDate_5", "root".id as id, null as type_0, null as type_1, null as type_2, null as type_3, null as type_4, "root".type as type_5 from BiTemporalProductTableWithBiTemporalMilestoning as "root" where "root".snapshotDate = DATE\'2015-08-25\' and "root".from_z <= DATE\'2018-08-26\' and "root".thru_z > DATE\'2018-08-26\') as "unionalias_1" on (("unionBase".prodFk_0 = "unionalias_1".id or "unionBase".prodFk_1 = "unionalias_1".id or "unionBase".prodFk_2 = "unionalias_1".id or "unionBase".prodFk_3 = "unionalias_1".id or "unionBase".prodFk_4 = "unionalias_1".id or "unionBase".prodFk_5 = "unionalias_1".id) and (("unionalias_1"."in_z_2" <= DATE\'2015-08-25\' and "unionalias_1"."out_z_2" > DATE\'2015-08-25\') or coalesce("unionalias_1"."in_z_2", "unionalias_1"."out_z_2") is null) and (coalesce("unionalias_1"."snapshotDate_3", "unionalias_1"."snapshotDate_5") = DATE\'2015-08-25\' or coalesce("unionalias_1"."snapshotDate_3", "unionalias_1"."snapshotDate_5") is null) and ((coalesce("unionalias_1"."from_z_0", "unionalias_1"."from_z_5") <= DATE\'2018-08-26\' and coalesce("unionalias_1"."thru_z_0", "unionalias_1"."thru_z_5") > DATE\'2018-08-26\') or coalesce("unionalias_1"."from_z_0", "unionalias_1"."from_z_5", "unionalias_1"."thru_z_0", "unionalias_1"."thru_z_5") is null) and ("unionalias_1"."snapshotDate_1" = DATE\'2018-08-26\' or "unionalias_1"."snapshotDate_1" is null)) left outer join (select "root".from_z as "from_z_0", "root".thru_z as "thru_z_0", null as "snapshotDate_1", null as "in_z_2", null as "out_z_2", null as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", "root".type as type, "root".type_description as "BiTemporalProductClassificationTableWithBusinessMilestoningtype_description_BiTemporalProductClassificationTableWithBusinessSnapshotMilestoningtype_description_BiTemporalProductClassificationTableWithProcessingMilestoning___5192ab2dc5823f50357032_0" from BiTemporalProductClassificationTableWithBusinessMilestoning as "root" where "root".from_z <= DATE\'2018-08-26\' and "root".thru_z > DATE\'2018-08-26\' union all select null as "from_z_0", null as "thru_z_0", "root".snapshotDate as "snapshotDate_1", null as "in_z_2", null as "out_z_2", null as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", "root".type as type, "root".type_description as "BiTemporalProductClassificationTableWithBusinessMilestoningtype_description_BiTemporalProductClassificationTableWithBusinessSnapshotMilestoningtype_description_BiTemporalProductClassificationTableWithProcessingMilestoning___5192ab2dc5823f50357032_0" from BiTemporalProductClassificationTableWithBusinessSnapshotMilestoning as "root" where "root".snapshotDate = DATE\'2018-08-26\' union all select null as "from_z_0", null as "thru_z_0", null as "snapshotDate_1", "root".in_z as "in_z_2", "root".out_z as "out_z_2", null as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", "root".type as type, "root".type_description as "BiTemporalProductClassificationTableWithBusinessMilestoningtype_description_BiTemporalProductClassificationTableWithBusinessSnapshotMilestoningtype_description_BiTemporalProductClassificationTableWithProcessingMilestoning___5192ab2dc5823f50357032_0" from BiTemporalProductClassificationTableWithProcessingMilestoning as "root" where "root".in_z <= DATE\'2015-08-25\' and "root".out_z > DATE\'2015-08-25\' union all select null as "from_z_0", null as "thru_z_0", null as "snapshotDate_1", null as "in_z_2", null as "out_z_2", "root".snapshotDate as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", "root".type as type, "root".type_description as "BiTemporalProductClassificationTableWithBusinessMilestoningtype_description_BiTemporalProductClassificationTableWithBusinessSnapshotMilestoningtype_description_BiTemporalProductClassificationTableWithProcessingMilestoning___5192ab2dc5823f50357032_0" from BiTemporalProductClassificationTableWithProcessingSnapshotMilestoning as "root" where "root".snapshotDate = DATE\'2015-08-25\' union all select null as "from_z_0", null as "thru_z_0", null as "snapshotDate_1", null as "in_z_2", null as "out_z_2", null as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", "root".type as type, "root".type_description as "BiTemporalProductClassificationTableWithBusinessMilestoningtype_description_BiTemporalProductClassificationTableWithBusinessSnapshotMilestoningtype_description_BiTemporalProductClassificationTableWithProcessingMilestoning___5192ab2dc5823f50357032_0" from BiTemporalProductClassificationTableWithNoMilestoning as "root" union all select null as "from_z_0", null as "thru_z_0", null as "snapshotDate_1", null as "in_z_2", null as "out_z_2", null as "snapshotDate_3", "root".from_z as "from_z_5", "root".thru_z as "thru_z_5", "root".snapshotDate as "snapshotDate_5", "root".type as type, "root".type_description as "BiTemporalProductClassificationTableWithBusinessMilestoningtype_description_BiTemporalProductClassificationTableWithBusinessSnapshotMilestoningtype_description_BiTemporalProductClassificationTableWithProcessingMilestoning___5192ab2dc5823f50357032_0" from BiTemporalProductClassificationTableWithBiTemporalMilestoning as "root" where "root".snapshotDate = DATE\'2015-08-25\' and "root".from_z <= DATE\'2018-08-26\' and "root".thru_z > DATE\'2018-08-26\') as "unionalias_2" on (("unionalias_1".type_0 = "unionalias_2".type or "unionalias_1".type_1 = "unionalias_2".type or "unionalias_1".type_2 = "unionalias_2".type or "unionalias_1".type_3 = "unionalias_2".type or "unionalias_1".type_4 = "unionalias_2".type or "unionalias_1".type_5 = "unionalias_2".type) and (("unionalias_2"."in_z_2" <= DATE\'2015-08-25\' and "unionalias_2"."out_z_2" > DATE\'2015-08-25\') or coalesce("unionalias_2"."in_z_2", "unionalias_2"."out_z_2") is null) and (coalesce("unionalias_2"."snapshotDate_3", "unionalias_2"."snapshotDate_5") = DATE\'2015-08-25\' or coalesce("unionalias_2"."snapshotDate_3", "unionalias_2"."snapshotDate_5") is null) and ((coalesce("unionalias_2"."from_z_0", "unionalias_2"."from_z_5") <= DATE\'2018-08-26\' and coalesce("unionalias_2"."thru_z_0", "unionalias_2"."thru_z_5") > DATE\'2018-08-26\') or coalesce("unionalias_2"."from_z_0", "unionalias_2"."from_z_5", "unionalias_2"."thru_z_0", "unionalias_2"."thru_z_5") is null) and ("unionalias_2"."snapshotDate_1" = DATE\'2018-08-26\' or "unionalias_2"."snapshotDate_1" is null)) where "unionalias_2"."BiTemporalProductClassificationTableWithBusinessMilestoningtype_description_BiTemporalProductClassificationTableWithBusinessSnapshotMilestoningtype_description_BiTemporalProductClassificationTableWithProcessingMilestoning___5192ab2dc5823f50357032_0" = \'STOCK DESC-V2\'',
    $result->sqlRemoveFormatting()
   );
   assertEquals([1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], $result.values.id);
}

function <<test.Test, test.AlloyOnly>> meta::relational::tests::milestoning::union::testPlanHybridMilestoningUnionOperationWithTemporalRootWithPropagation():Boolean[1]
{
   testHybridMilestoningUnionOperationWithTemporalRootWithPropagation([
     'BiTemporalProductClassificationTableWithBusinessMilestoningtype_description_BiTemporalProductClassificationTableWithBusinessSnapshotMilestoningtype_description_BiTemporalProductClassificationTableWithProcessingMilestoning___c88f893dbce2fa7329ae22_0'
   ]->repeat(5));
}

function <<test.Test, test.ExcludeAlloy>> meta::relational::tests::milestoning::union::testInFlowHybridMilestoningUnionOperationWithTemporalRootWithPropagation():Boolean[1]
{
   let tableName = [
     'BiTemporalProductClassificationTableWithBusinessMilestoningtype_description_BiTemporalProductClassificationTableWithBusinessSnapshotMilestoningtype_description_BiTemporalProductClassificationTableWithProcessingMilestoning___c88f893dbce2fa7329ae22_0'
   ]->repeat(5);
   let result = execute(|BiTemporalProduct.all(%2015-8-25, %2018-8-26)->filter(p|$p.biTemporalClassification.description == 'STOCK DESC-V2'), hybridMilestoningUnionMap, meta::external::store::relational::tests::testRuntime(), meta::relational::extension::relationalExtensions());
   assertEquals(
     'select "unionBase".u_type as u_type, "unionBase"."pk_0_0" as "pk_0_0", "unionBase"."pk_0_1" as "pk_0_1", "unionBase"."pk_0_2" as "pk_0_2", "unionBase"."pk_0_3" as "pk_0_3", "unionBase"."pk_0_4" as "pk_0_4", "unionBase"."pk_0_5" as "pk_0_5", "unionBase"."id" as "id", "unionBase"."name" as "name", "unionBase"."k_processingDate" as "k_processingDate", "unionBase"."k_businessDate" as "k_businessDate", "unionBase"."from_z_0" as "from_z_0", "unionBase"."thru_z_0" as "thru_z_0", "unionBase"."snapshotDate_1" as "snapshotDate_1", "unionBase"."in_z_2" as "in_z_2", "unionBase"."out_z_2" as "out_z_2", "unionBase"."snapshotDate_3" as "snapshotDate_3", "unionBase"."from_z_5" as "from_z_5", "unionBase"."thru_z_5" as "thru_z_5", "unionBase"."snapshotDate_5" as "snapshotDate_5" from (select \'0\' as u_type, "root".id as "pk_0_0", null as "pk_0_1", null as "pk_0_2", null as "pk_0_3", null as "pk_0_4", null as "pk_0_5", "root".id as "id", "root".name as "name", \'2015-08-25\' as "k_processingDate", \'2018-08-26\' as "k_businessDate", "root".from_z as "from_z_0", "root".thru_z as "thru_z_0", null as "snapshotDate_1", null as "in_z_2", null as "out_z_2", null as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", "root".type as type_0, null as type_1, null as type_2, null as type_3, null as type_4, null as type_5 from BiTemporalProductTableWithBusinessMilestoning as "root" where "root".from_z <= DATE\'2018-08-26\' and "root".thru_z > DATE\'2018-08-26\' union all select \'1\' as u_type, null as "pk_0_0", "root".id as "pk_0_1", null as "pk_0_2", null as "pk_0_3", null as "pk_0_4", null as "pk_0_5", "root".id as "id", "root".name as "name", \'2015-08-25\' as "k_processingDate", \'2018-08-26\' as "k_businessDate", null as "from_z_0", null as "thru_z_0", "root".snapshotDate as "snapshotDate_1", null as "in_z_2", null as "out_z_2", null as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", null as type_0, "root".type as type_1, null as type_2, null as type_3, null as type_4, null as type_5 from BiTemporalProductTableWithBusinessSnapshotMilestoning as "root" where "root".snapshotDate = DATE\'2018-08-26\' union all select \'2\' as u_type, null as "pk_0_0", null as "pk_0_1", "root".id as "pk_0_2", null as "pk_0_3", null as "pk_0_4", null as "pk_0_5", "root".id as "id", "root".name as "name", \'2015-08-25\' as "k_processingDate", \'2018-08-26\' as "k_businessDate", null as "from_z_0", null as "thru_z_0", null as "snapshotDate_1", "root".in_z as "in_z_2", "root".out_z as "out_z_2", null as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", null as type_0, null as type_1, "root".type as type_2, null as type_3, null as type_4, null as type_5 from BiTemporalProductTableWithProcessingMilestoning as "root" where "root".in_z <= DATE\'2015-08-25\' and "root".out_z > DATE\'2015-08-25\' union all select \'3\' as u_type, null as "pk_0_0", null as "pk_0_1", null as "pk_0_2", "root".id as "pk_0_3", null as "pk_0_4", null as "pk_0_5", "root".id as "id", "root".name as "name", \'2015-08-25\' as "k_processingDate", \'2018-08-26\' as "k_businessDate", null as "from_z_0", null as "thru_z_0", null as "snapshotDate_1", null as "in_z_2", null as "out_z_2", "root".snapshotDate as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", null as type_0, null as type_1, null as type_2, "root".type as type_3, null as type_4, null as type_5 from BiTemporalProductTableWithProcessingSnapshotMilestoning as "root" where "root".snapshotDate = DATE\'2015-08-25\' union all select \'4\' as u_type, null as "pk_0_0", null as "pk_0_1", null as "pk_0_2", null as "pk_0_3", "root".id as "pk_0_4", null as "pk_0_5", "root".id as "id", "root".name as "name", \'2015-08-25\' as "k_processingDate", \'2018-08-26\' as "k_businessDate", null as "from_z_0", null as "thru_z_0", null as "snapshotDate_1", null as "in_z_2", null as "out_z_2", null as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", null as type_0, null as type_1, null as type_2, null as type_3, "root".type as type_4, null as type_5 from BiTemporalProductTableWithNoMilestoning as "root" union all select \'5\' as u_type, null as "pk_0_0", null as "pk_0_1", null as "pk_0_2", null as "pk_0_3", null as "pk_0_4", "root".id as "pk_0_5", "root".id as "id", "root".name as "name", \'2015-08-25\' as "k_processingDate", \'2018-08-26\' as "k_businessDate", null as "from_z_0", null as "thru_z_0", null as "snapshotDate_1", null as "in_z_2", null as "out_z_2", null as "snapshotDate_3", "root".from_z as "from_z_5", "root".thru_z as "thru_z_5", "root".snapshotDate as "snapshotDate_5", null as type_0, null as type_1, null as type_2, null as type_3, null as type_4, "root".type as type_5 from BiTemporalProductTableWithBiTemporalMilestoning as "root" where "root".snapshotDate = DATE\'2015-08-25\' and "root".from_z <= DATE\'2018-08-26\' and "root".thru_z > DATE\'2018-08-26\') as "unionBase" left outer join (select "root".from_z as "from_z_0", "root".thru_z as "thru_z_0", null as "snapshotDate_1", null as "in_z_2", null as "out_z_2", null as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", "root".type as type, "root".type_description as "BiTemporalProductClassificationTableWithBusinessMilestoningtype_description_BiTemporalProductClassificationTableWithBusinessSnapshotMilestoningtype_description_BiTemporalProductClassificationTableWithProcessingMilestoning___5192ab2dc5823f50357032_0" from BiTemporalProductClassificationTableWithBusinessMilestoning as "root" where "root".from_z <= DATE\'2018-08-26\' and "root".thru_z > DATE\'2018-08-26\' union all select null as "from_z_0", null as "thru_z_0", "root".snapshotDate as "snapshotDate_1", null as "in_z_2", null as "out_z_2", null as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", "root".type as type, "root".type_description as "BiTemporalProductClassificationTableWithBusinessMilestoningtype_description_BiTemporalProductClassificationTableWithBusinessSnapshotMilestoningtype_description_BiTemporalProductClassificationTableWithProcessingMilestoning___5192ab2dc5823f50357032_0" from BiTemporalProductClassificationTableWithBusinessSnapshotMilestoning as "root" where "root".snapshotDate = DATE\'2018-08-26\' union all select null as "from_z_0", null as "thru_z_0", null as "snapshotDate_1", "root".in_z as "in_z_2", "root".out_z as "out_z_2", null as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", "root".type as type, "root".type_description as "BiTemporalProductClassificationTableWithBusinessMilestoningtype_description_BiTemporalProductClassificationTableWithBusinessSnapshotMilestoningtype_description_BiTemporalProductClassificationTableWithProcessingMilestoning___5192ab2dc5823f50357032_0" from BiTemporalProductClassificationTableWithProcessingMilestoning as "root" where "root".in_z <= DATE\'2015-08-25\' and "root".out_z > DATE\'2015-08-25\' union all select null as "from_z_0", null as "thru_z_0", null as "snapshotDate_1", null as "in_z_2", null as "out_z_2", "root".snapshotDate as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", "root".type as type, "root".type_description as "BiTemporalProductClassificationTableWithBusinessMilestoningtype_description_BiTemporalProductClassificationTableWithBusinessSnapshotMilestoningtype_description_BiTemporalProductClassificationTableWithProcessingMilestoning___5192ab2dc5823f50357032_0" from BiTemporalProductClassificationTableWithProcessingSnapshotMilestoning as "root" where "root".snapshotDate = DATE\'2015-08-25\' union all select null as "from_z_0", null as "thru_z_0", null as "snapshotDate_1", null as "in_z_2", null as "out_z_2", null as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", "root".type as type, "root".type_description as "BiTemporalProductClassificationTableWithBusinessMilestoningtype_description_BiTemporalProductClassificationTableWithBusinessSnapshotMilestoningtype_description_BiTemporalProductClassificationTableWithProcessingMilestoning___5192ab2dc5823f50357032_0" from BiTemporalProductClassificationTableWithNoMilestoning as "root" union all select null as "from_z_0", null as "thru_z_0", null as "snapshotDate_1", null as "in_z_2", null as "out_z_2", null as "snapshotDate_3", "root".from_z as "from_z_5", "root".thru_z as "thru_z_5", "root".snapshotDate as "snapshotDate_5", "root".type as type, "root".type_description as "BiTemporalProductClassificationTableWithBusinessMilestoningtype_description_BiTemporalProductClassificationTableWithBusinessSnapshotMilestoningtype_description_BiTemporalProductClassificationTableWithProcessingMilestoning___5192ab2dc5823f50357032_0" from BiTemporalProductClassificationTableWithBiTemporalMilestoning as "root" where "root".snapshotDate = DATE\'2015-08-25\' and "root".from_z <= DATE\'2018-08-26\' and "root".thru_z > DATE\'2018-08-26\') as "unionalias_1" on (("unionBase".type_0 = "unionalias_1".type or "unionBase".type_1 = "unionalias_1".type or "unionBase".type_2 = "unionalias_1".type or "unionBase".type_3 = "unionalias_1".type or "unionBase".type_4 = "unionalias_1".type or "unionBase".type_5 = "unionalias_1".type) and (("unionalias_1"."in_z_2" <= DATE\'2015-08-25\' and "unionalias_1"."out_z_2" > DATE\'2015-08-25\') or coalesce("unionalias_1"."in_z_2", "unionalias_1"."out_z_2") is null) and (coalesce("unionalias_1"."snapshotDate_3", "unionalias_1"."snapshotDate_5") = DATE\'2015-08-25\' or coalesce("unionalias_1"."snapshotDate_3", "unionalias_1"."snapshotDate_5") is null) and ((coalesce("unionalias_1"."from_z_0", "unionalias_1"."from_z_5") <= DATE\'2018-08-26\' and coalesce("unionalias_1"."thru_z_0", "unionalias_1"."thru_z_5") > DATE\'2018-08-26\') or coalesce("unionalias_1"."from_z_0", "unionalias_1"."from_z_5", "unionalias_1"."thru_z_0", "unionalias_1"."thru_z_5") is null) and ("unionalias_1"."snapshotDate_1" = DATE\'2018-08-26\' or "unionalias_1"."snapshotDate_1" is null)) where "unionalias_1"."BiTemporalProductClassificationTableWithBusinessMilestoningtype_description_BiTemporalProductClassificationTableWithBusinessSnapshotMilestoningtype_description_BiTemporalProductClassificationTableWithProcessingMilestoning___5192ab2dc5823f50357032_0" = \'STOCK DESC-V2\'',
    $result->sqlRemoveFormatting()
   );
   assertEquals([1, 1, 1, 1, 1, 1, 1, 1], $result.values.id);
}

function <<access.private>> meta::relational::tests::milestoning::union::testHybridMilestoningUnionOperationWithTemporalRootWithPropagation(
  tableNames: String[*]
): Boolean[1]
{
   let result = execute(|BiTemporalProduct.all(%2015-8-25, %2018-8-26)->filter(p|$p.biTemporalClassification.description == 'STOCK DESC-V2'), hybridMilestoningUnionMap, meta::external::store::relational::tests::testRuntime(), meta::relational::extension::relationalExtensions());
   assertEquals(
    'select "unionBase".u_type as u_type, "unionBase"."pk_0_0" as "pk_0_0", "unionBase"."pk_0_1" as "pk_0_1", "unionBase"."pk_0_2" as "pk_0_2", "unionBase"."pk_0_3" as "pk_0_3", "unionBase"."pk_0_4" as "pk_0_4", "unionBase"."pk_0_5" as "pk_0_5", "unionBase"."id" as "id", "unionBase"."name" as "name", "unionBase"."k_processingDate" as "k_processingDate", "unionBase"."k_businessDate" as "k_businessDate", "unionBase"."from_z_0" as "from_z_0", "unionBase"."thru_z_0" as "thru_z_0", "unionBase"."snapshotDate_1" as "snapshotDate_1", "unionBase"."in_z_2" as "in_z_2", "unionBase"."out_z_2" as "out_z_2", "unionBase"."snapshotDate_3" as "snapshotDate_3", "unionBase"."from_z_5" as "from_z_5", "unionBase"."thru_z_5" as "thru_z_5", "unionBase"."snapshotDate_5" as "snapshotDate_5" from (select \'0\' as u_type, "root".id as "pk_0_0", null as "pk_0_1", null as "pk_0_2", null as "pk_0_3", null as "pk_0_4", null as "pk_0_5", "root".id as "id", "root".name as "name", \'2015-08-25\' as "k_processingDate", \'2018-08-26\' as "k_businessDate", "root".from_z as "from_z_0", "root".thru_z as "thru_z_0", null as "snapshotDate_1", null as "in_z_2", null as "out_z_2", null as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", "root".type as type_0, null as type_1, null as type_2, null as type_3, null as type_4, null as type_5 from BiTemporalProductTableWithBusinessMilestoning as "root" where "root".from_z <= DATE\'2018-08-26\' and "root".thru_z > DATE\'2018-08-26\' union all select \'1\' as u_type, null as "pk_0_0", "root".id as "pk_0_1", null as "pk_0_2", null as "pk_0_3", null as "pk_0_4", null as "pk_0_5", "root".id as "id", "root".name as "name", \'2015-08-25\' as "k_processingDate", \'2018-08-26\' as "k_businessDate", null as "from_z_0", null as "thru_z_0", "root".snapshotDate as "snapshotDate_1", null as "in_z_2", null as "out_z_2", null as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", null as type_0, "root".type as type_1, null as type_2, null as type_3, null as type_4, null as type_5 from BiTemporalProductTableWithBusinessSnapshotMilestoning as "root" where "root".snapshotDate = DATE\'2018-08-26\' union all select \'2\' as u_type, null as "pk_0_0", null as "pk_0_1", "root".id as "pk_0_2", null as "pk_0_3", null as "pk_0_4", null as "pk_0_5", "root".id as "id", "root".name as "name", \'2015-08-25\' as "k_processingDate", \'2018-08-26\' as "k_businessDate", null as "from_z_0", null as "thru_z_0", null as "snapshotDate_1", "root".in_z as "in_z_2", "root".out_z as "out_z_2", null as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", null as type_0, null as type_1, "root".type as type_2, null as type_3, null as type_4, null as type_5 from BiTemporalProductTableWithProcessingMilestoning as "root" where "root".in_z <= DATE\'2015-08-25\' and "root".out_z > DATE\'2015-08-25\' union all select \'3\' as u_type, null as "pk_0_0", null as "pk_0_1", null as "pk_0_2", "root".id as "pk_0_3", null as "pk_0_4", null as "pk_0_5", "root".id as "id", "root".name as "name", \'2015-08-25\' as "k_processingDate", \'2018-08-26\' as "k_businessDate", null as "from_z_0", null as "thru_z_0", null as "snapshotDate_1", null as "in_z_2", null as "out_z_2", "root".snapshotDate as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", null as type_0, null as type_1, null as type_2, "root".type as type_3, null as type_4, null as type_5 from BiTemporalProductTableWithProcessingSnapshotMilestoning as "root" where "root".snapshotDate = DATE\'2015-08-25\' union all select \'4\' as u_type, null as "pk_0_0", null as "pk_0_1", null as "pk_0_2", null as "pk_0_3", "root".id as "pk_0_4", null as "pk_0_5", "root".id as "id", "root".name as "name", \'2015-08-25\' as "k_processingDate", \'2018-08-26\' as "k_businessDate", null as "from_z_0", null as "thru_z_0", null as "snapshotDate_1", null as "in_z_2", null as "out_z_2", null as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", null as type_0, null as type_1, null as type_2, null as type_3, "root".type as type_4, null as type_5 from BiTemporalProductTableWithNoMilestoning as "root" union all select \'5\' as u_type, null as "pk_0_0", null as "pk_0_1", null as "pk_0_2", null as "pk_0_3", null as "pk_0_4", "root".id as "pk_0_5", "root".id as "id", "root".name as "name", \'2015-08-25\' as "k_processingDate", \'2018-08-26\' as "k_businessDate", null as "from_z_0", null as "thru_z_0", null as "snapshotDate_1", null as "in_z_2", null as "out_z_2", null as "snapshotDate_3", "root".from_z as "from_z_5", "root".thru_z as "thru_z_5", "root".snapshotDate as "snapshotDate_5", null as type_0, null as type_1, null as type_2, null as type_3, null as type_4, "root".type as type_5 from BiTemporalProductTableWithBiTemporalMilestoning as "root" where "root".snapshotDate = DATE\'2015-08-25\' and "root".from_z <= DATE\'2018-08-26\' and "root".thru_z > DATE\'2018-08-26\') as "unionBase" left outer join (select "root".from_z as "from_z_0", "root".thru_z as "thru_z_0", null as "snapshotDate_1", null as "in_z_2", null as "out_z_2", null as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", "root".type as type, "root".type_description as "BiTemporalProductClassificationTableWithBusinessMilestoningtype_description_BiTemporalProductClassificationTableWithBusinessSnapshotMilestoningtype_description_BiTemporalProductClassificationTableWithProcessingMilestoning___5192ab2dc5823f50357032_0" from BiTemporalProductClassificationTableWithBusinessMilestoning as "root" where "root".from_z <= DATE\'2018-08-26\' and "root".thru_z > DATE\'2018-08-26\' union all select null as "from_z_0", null as "thru_z_0", "root".snapshotDate as "snapshotDate_1", null as "in_z_2", null as "out_z_2", null as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", "root".type as type, "root".type_description as "BiTemporalProductClassificationTableWithBusinessMilestoningtype_description_BiTemporalProductClassificationTableWithBusinessSnapshotMilestoningtype_description_BiTemporalProductClassificationTableWithProcessingMilestoning___5192ab2dc5823f50357032_0" from BiTemporalProductClassificationTableWithBusinessSnapshotMilestoning as "root" where "root".snapshotDate = DATE\'2018-08-26\' union all select null as "from_z_0", null as "thru_z_0", null as "snapshotDate_1", "root".in_z as "in_z_2", "root".out_z as "out_z_2", null as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", "root".type as type, "root".type_description as "BiTemporalProductClassificationTableWithBusinessMilestoningtype_description_BiTemporalProductClassificationTableWithBusinessSnapshotMilestoningtype_description_BiTemporalProductClassificationTableWithProcessingMilestoning___5192ab2dc5823f50357032_0" from BiTemporalProductClassificationTableWithProcessingMilestoning as "root" where "root".in_z <= DATE\'2015-08-25\' and "root".out_z > DATE\'2015-08-25\' union all select null as "from_z_0", null as "thru_z_0", null as "snapshotDate_1", null as "in_z_2", null as "out_z_2", "root".snapshotDate as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", "root".type as type, "root".type_description as "BiTemporalProductClassificationTableWithBusinessMilestoningtype_description_BiTemporalProductClassificationTableWithBusinessSnapshotMilestoningtype_description_BiTemporalProductClassificationTableWithProcessingMilestoning___5192ab2dc5823f50357032_0" from BiTemporalProductClassificationTableWithProcessingSnapshotMilestoning as "root" where "root".snapshotDate = DATE\'2015-08-25\' union all select null as "from_z_0", null as "thru_z_0", null as "snapshotDate_1", null as "in_z_2", null as "out_z_2", null as "snapshotDate_3", null as "from_z_5", null as "thru_z_5", null as "snapshotDate_5", "root".type as type, "root".type_description as "BiTemporalProductClassificationTableWithBusinessMilestoningtype_description_BiTemporalProductClassificationTableWithBusinessSnapshotMilestoningtype_description_BiTemporalProductClassificationTableWithProcessingMilestoning___5192ab2dc5823f50357032_0" from BiTemporalProductClassificationTableWithNoMilestoning as "root" union all select null as "from_z_0", null as "thru_z_0", null as "snapshotDate_1", null as "in_z_2", null as "out_z_2", null as "snapshotDate_3", "root".from_z as "from_z_5", "root".thru_z as "thru_z_5", "root".snapshotDate as "snapshotDate_5", "root".type as type, "root".type_description as "BiTemporalProductClassificationTableWithBusinessMilestoningtype_description_BiTemporalProductClassificationTableWithBusinessSnapshotMilestoningtype_description_BiTemporalProductClassificationTableWithProcessingMilestoning___5192ab2dc5823f50357032_0" from BiTemporalProductClassificationTableWithBiTemporalMilestoning as "root" where "root".snapshotDate = DATE\'2015-08-25\' and "root".from_z <= DATE\'2018-08-26\' and "root".thru_z > DATE\'2018-08-26\') as "unionalias_1" on (("unionBase".type_0 = "unionalias_1".type or "unionBase".type_1 = "unionalias_1".type or "unionBase".type_2 = "unionalias_1".type or "unionBase".type_3 = "unionalias_1".type or "unionBase".type_4 = "unionalias_1".type or "unionBase".type_5 = "unionalias_1".type) and (("unionalias_1"."in_z_2" <= DATE\'2015-08-25\' and "unionalias_1"."out_z_2" > DATE\'2015-08-25\') or coalesce("unionalias_1"."in_z_2", "unionalias_1"."out_z_2") is null) and (coalesce("unionalias_1"."snapshotDate_3", "unionalias_1"."snapshotDate_5") = DATE\'2015-08-25\' or coalesce("unionalias_1"."snapshotDate_3", "unionalias_1"."snapshotDate_5") is null) and ((coalesce("unionalias_1"."from_z_0", "unionalias_1"."from_z_5") <= DATE\'2018-08-26\' and coalesce("unionalias_1"."thru_z_0", "unionalias_1"."thru_z_5") > DATE\'2018-08-26\') or coalesce("unionalias_1"."from_z_0", "unionalias_1"."from_z_5", "unionalias_1"."thru_z_0", "unionalias_1"."thru_z_5") is null) and ("unionalias_1"."snapshotDate_1" = DATE\'2018-08-26\' or "unionalias_1"."snapshotDate_1" is null)) where "unionalias_1"."BiTemporalProductClassificationTableWithBusinessMilestoningtype_description_BiTemporalProductClassificationTableWithBusinessSnapshotMilestoningtype_description_BiTemporalProductClassificationTableWithProcessingMilestoning___5192ab2dc5823f50357032_0" = \'STOCK DESC-V2\'',
    $result->sqlRemoveFormatting()
   );
   assertEquals([1, 1, 1, 1, 1, 1, 1, 1], $result.values.id);
}

function <<test.Test>> meta::relational::tests::milestoning::union::testMilestoningWithUnionOnView():Boolean[1]
{
  let result = execute(|BiTemporalProduct.all(%2015-8-25, %2018-8-26)->project(p|$p.classification.type, 'classification type'), meta::relational::tests::milestoning::UnionOnViewWithMilestoningMapping, meta::external::store::relational::tests::testRuntime(), meta::relational::extension::relationalExtensions());
  assertEquals('classification type\nSTOCK\n\n', $result.values->cast(@TabularDataSet)->meta::relational::tests::csv::toCSV());
}

function <<test.Test>> meta::relational::tests::milestoning::union::testMilestoningWithUnionOnViewWithAllVersions():Boolean[1]
{
  let result = execute(|BiTemporalProduct.all(%2015-8-25, %2018-8-26)->project(p|$p.classificationAllVersions.type, 'classification type'), meta::relational::tests::milestoning::UnionOnViewWithMilestoningMapping, meta::external::store::relational::tests::testRuntime(), meta::relational::extension::relationalExtensions());
  assertEquals('classification type\nSTOCK\nSTOCK\nSTOCK\nSTOCK\nOPTION\n', $result.values->cast(@TabularDataSet)->meta::relational::tests::csv::toCSV());
}

function <<test.BeforePackage>> meta::relational::tests::milestoning::union::setUp():Runtime[1]
{
   initDatabase();
}
