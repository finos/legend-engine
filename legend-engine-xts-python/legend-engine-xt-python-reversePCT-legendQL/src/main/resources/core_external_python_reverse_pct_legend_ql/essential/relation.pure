// Copyright 2025 Goldman Sachs
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

import meta::pure::test::pct::reversePCT::framework::*;
import meta::external::python::reversePCT::legendQL::*;

function meta::external::python::reversePCT::legendQL::pythonLegendQLReversesEssentialRelation(): ReversesForSource[*]
{
  [
    meta::pure::functions::relation::tests::size::testSimpleSize_Function_1__Boolean_1_->testRev(
        [
          rev('|<@_0006a8o instanceOf meta::pure::metamodel::relation::TDS>->meta::pure::functions::relation::size()',
        'LegendQLApiCsvNonExecutableInputTdsFrame.from_csv_string(csv_string="val,str\\n 1,a\\n 3,ewe\\n 4,qw").extend(("col4", lambda r: r.get_integer(\'val\') + 1))')
        ]
      ),
    meta::pure::functions::relation::tests::ntile::testOLAPWithPartitionAndOrderNTile_Function_1__Boolean_1_->testRev(
        [
          rev(
            '|<@_00066fg instanceOf meta::pure::metamodel::relation::TDS>->meta::pure::functions::relation::extend(~grp->meta::pure::functions::relation::over(~name->meta::pure::functions::relation::descending()), ~other:{p: meta::pure::metamodel::relation::Relation<(id:Integer, grp:Integer, name:String)>[1], w: meta::pure::functions::relation::_Window<(id:Integer, grp:Integer, name:String)>[1], r: (id:Integer, grp:Integer, name:String)[1]|$p->meta::pure::functions::relation::ntile($r, 2)})'
            ,
            '(lambda: ((lambda frame: frame.window_extend(frame.window(partition_by="grp", order_by=lambda r: [r.name.descending()]), ("other", lambda p, w, r: p.ntile(r, 2))))(LegendQLApiCsvNonExecutableInputTdsFrame.from_csv_string(csv_string="id,grp,name\\n1,1,A\\n3,1,B\\n3,1,C\\n4,4,D\\n3,1,E\\n6,1,F\\n7,4,G\\n8,1,H\\n9,5,I\\n10,0,J"))))()'
          )
        ]
        ),
    meta::pure::functions::relation::tests::rank::testOLAPWithPartitionAndOrderRank_Function_1__Boolean_1_->testRev(
        [
          rev(
            '|#TDS{\n'+
                          'id,grp,name\n'+
                          '1,2,A\n'+
                          '2,1,B\n'+
                          '3,3,C\n'+
                          '4,4,D\n'+
                          '5,2,E\n'+
                          '8,1,F\n'+
                          '7,3,G\n'+
                          '8,1,H\n'+
                          '9,5,I\n'+
                          '10,0,J}#->meta::pure::functions::relation::extend(~grp->meta::pure::functions::relation::over(~id->meta::pure::functions::relation::descending()), ~other:{p: meta::pure::metamodel::relation::Relation<(id:Integer, grp:Integer, name:String)>[1], w: meta::pure::functions::relation::_Window<(id:Integer, grp:Integer, name:String)>[1], r: (id:Integer, grp:Integer, name:String)[1]|$p->meta::pure::functions::relation::rank($w, $r)})'
            ,
            '(lambda: ((lambda frame: frame.window_extend(frame.window(partition_by=["grp"],order_by=lambda r: r.id.descending()), ("other", lambda p, w, r: p.rank(w, r))))(LegendQLApiCsvNonExecutableInputTdsFrame.from_csv_string(csv_string="id,grp,name\\n1,2,A\\n2,1,B\\n3,3,C\\n4,4,D\\n5,2,E\\n8,1,F\\n7,3,G\\n8,1,H\\n9,5,I\\n10,0,J"))))()'
          )
        ]
        ),
    [
      meta::pure::functions::relation::tests::drop::testSimpleDropShared_Function_1__Boolean_1_->testRev(
        [ 
          rev(
            '|<@_0006a3e instanceOf meta::pure::metamodel::relation::TDS>->meta::pure::functions::relation::sort(~val->meta::pure::functions::relation::ascending())->meta::pure::functions::relation::drop(3)',
            'LegendQLApiCsvNonExecutableInputTdsFrame.from_csv_string(csv_string="val,str\\n1,a\\n3,ewe\\n4,qw\\n5,wwe\\n6,weq").sort(["val"]).drop(3)'          
          )
        ]
      ),
      meta::pure::functions::relation::tests::drop::testSimpleDrop_MultipleExpressions_Function_1__Boolean_1_->testRev(
        [ 
          rev(
            '|let t = <@_0006a5v instanceOf meta::pure::metamodel::relation::TDS>;\n let t2 = $t->meta::pure::functions::relation::drop(2);\n $t2->meta::pure::functions::relation::drop(1);\n',
            'LegendQLApiCsvNonExecutableInputTdsFrame.from_csv_string(csv_string="val,str\\n1,a\\n3,ewe\\n4,qw\\n5,wwe\\n6,weq").drop(2).drop(1)'          
          )
        ]
      )
    ]->combine(),
    [
      meta::pure::functions::relation::tests::slice::testSimpleSliceShared_Function_1__Boolean_1_->testRev(
        [ 
          rev(
            '|<@_00069mi instanceOf meta::pure::metamodel::relation::TDS>->meta::pure::functions::relation::sort(~val->meta::pure::functions::relation::ascending())->meta::pure::functions::relation::slice(1, 3)',
            'LegendQLApiCsvNonExecutableInputTdsFrame.from_csv_string(csv_string="val,str\\n1,a\\n3,ewe\\n4,qw\\n5,wwe\\n6,weq").sort(["val"]).slice(1,3)'          
          )
        ]
      ),
      meta::pure::functions::relation::tests::slice::testSimpleSlice_MultipleExpressions_Function_1__Boolean_1_->testRev(
        [ 
          rev(
            '|let t = <@_00069pj instanceOf meta::pure::metamodel::relation::TDS>;\n let t2 = $t->meta::pure::functions::relation::slice(1, 4);\n $t2->meta::pure::functions::relation::slice(0, 2);\n',
            'LegendQLApiCsvNonExecutableInputTdsFrame.from_csv_string(csv_string="val,str\\n1,a\\n3,ewe\\n4,qw\\n5,wwe\\n6,weq").slice(1,4).slice(0,2)'          
          )
        ]
      )
    ]->combine(),
    [
      meta::pure::functions::relation::tests::limit::testSimpleLimitShared_Function_1__Boolean_1_->testRev(
        [ 
          rev(
            '|<@_000693k instanceOf meta::pure::metamodel::relation::TDS>->meta::pure::functions::relation::sort(~val->meta::pure::functions::relation::ascending())->meta::pure::functions::relation::limit(3)',
            'LegendQLApiCsvNonExecutableInputTdsFrame.from_csv_string(csv_string="val,str\\n1,a\\n3,ewe\\n4,qw\\n5,wwe\\n6,weq").sort(["val"]).limit(3)'          
          )
        ]
      ),
      meta::pure::functions::relation::tests::limit::testSimpleLimit_MultipleExpressions_Function_1__Boolean_1_->testRev(
        [ 
          rev(
            '|let t = <@_000696l instanceOf meta::pure::metamodel::relation::TDS>;\n $t->meta::pure::functions::relation::sort(~val->meta::pure::functions::relation::ascending())->meta::pure::functions::relation::limit(3);\n',
            'LegendQLApiCsvNonExecutableInputTdsFrame.from_csv_string(csv_string="val,str\\n1,a\\n3,ewe\\n4,qw\\n5,wwe\\n6,weq").sort(["val"]).limit(3)'          
          )
        ]
      )
    ]->combine(),
    [
      meta::pure::functions::relation::tests::sort::testSimpleSortShared_Function_1__Boolean_1_->testRev(
        [ 
          rev(
            '|<@_00067uc instanceOf meta::pure::metamodel::relation::TDS>->meta::pure::functions::relation::sort(~id->meta::pure::functions::relation::ascending())',
            'LegendQLApiCsvNonExecutableInputTdsFrame.from_csv_string(csv_string="id,name\\n2,George\\n3,Pierre\\n1,Sachin\\n1,Neema\\n5,David\\n4,Alex\\n2,Thierry").sort(["id"])'          
          ),
          rev(
            '|<@_0006808 instanceOf meta::pure::metamodel::relation::TDS>->meta::pure::functions::relation::sort([~id->meta::pure::functions::relation::ascending(), ~name->meta::pure::functions::relation::ascending()])',
            'LegendQLApiCsvNonExecutableInputTdsFrame.from_csv_string(csv_string="id,name\\n2,George\\n3,Pierre\\n1,Sachin\\n1,Neema\\n5,David\\n4,Alex\\n2,Thierry").sort(["id","name"])'          
          ),
          rev(
            '|<@_000682n instanceOf meta::pure::metamodel::relation::TDS>->meta::pure::functions::relation::sort([~id->meta::pure::functions::relation::descending(), ~name->meta::pure::functions::relation::ascending()])',
            'LegendQLApiCsvNonExecutableInputTdsFrame.from_csv_string(csv_string="id,name\\n2,George\\n3,Pierre\\n1,Sachin\\n1,Neema\\n5,David\\n4,Alex\\n2,Thierry").sort(lambda r: [r["id"].descending(), r["name"].ascending()])'          
          )
        ]
      ),
      meta::pure::functions::relation::tests::sort::testSimpleSort_MultipleExpressions_Function_1__Boolean_1_->testRev(
        [ 
          rev(
            '|let t = <@_000696l instanceOf meta::pure::metamodel::relation::TDS>;\n $t->meta::pure::functions::relation::sort(~id->meta::pure::functions::relation::ascending());\n',
            'LegendQLApiCsvNonExecutableInputTdsFrame.from_csv_string(csv_string="id,name\\n2,George\\n3,Pierre\\n1,Sachin\\n1,Neema\\n5,David\\n4,Alex\\n2,Thierry").sort(["id"])'          
          ),
          rev(
            '|let t = <@_000685u instanceOf meta::pure::metamodel::relation::TDS>;\n $t->meta::pure::functions::relation::sort(~id->meta::pure::functions::relation::ascending());\n',
            'LegendQLApiCsvNonExecutableInputTdsFrame.from_csv_string(csv_string="id,name\\n2,George\\n3,Pierre\\n1,Sachin\\n1,Neema\\n5,David\\n4,Alex\\n2,Thierry").sort(["id"])'          
          ),
          rev(
            '|let t = <@_000687u instanceOf meta::pure::metamodel::relation::TDS>;\n $t->meta::pure::functions::relation::sort([~id->meta::pure::functions::relation::ascending(), ~name->meta::pure::functions::relation::ascending()]);\n',
            'LegendQLApiCsvNonExecutableInputTdsFrame.from_csv_string(csv_string="id,name\\n2,George\\n3,Pierre\\n1,Sachin\\n1,Neema\\n5,David\\n4,Alex\\n2,Thierry").sort(["id","name"])'          
          )
        ]
      )
    ]->combine()
  ]
}